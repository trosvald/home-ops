version: v1alpha1
debug: false
persist: true
machine:
    type: controlplane
    token: ENC[AES256_GCM,data:+19Tp0oqNkEJVTzmwZdLqBrxg1TC3hA=,iv:mhn6hW3Lh9BWwSYgMxpiGdT7WpqaWAclCvbmhQdkoYU=,tag:nxdkahrJZdGW2ICWPj7xuw==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:tE9bj7OWMYSPhQQEc+99QS+Sh/r0aHpdwVo7l7P+v8N5g4CY21QPrts/P0RnOJF26dJrGxKlt/YdOsc6f5FN7+5ERvUPM4HkQhHWqsEvpgqJ6ww7+0g3LbOwYPqQC9PyOZ3D/wxGIWxtjnFKeCFI9DcmG2g1B7aQkFWVPDe4x1OtNu+gKtUTcUI69y2csQb7ae0SHWWEfk+jjjWzLU/2ARdoDVWzKwvgjWmFD+lmwQv3HThuIhR0sgLVKwOHgQn34+550o5jdOGuvCQreCXLYIZc8wx80WoY7irjFHVAP/g/j7h4QMhETuH4x/FA0+mm+MenC+O0pIVKlUGNfc08AZcDORkk2VkLsabypfNEXAqbRjHaPMJek4DLNVv7bJljPIyXtmX4JAnV7eJOXZ7zXwLo7FtEoHu4dg679eDRrxlHeQShcDokX0u+1gUCeRpCcp94WYG4buK9VyUwfiQUt3g07yM1Ea146cdRsNLI86WYkiO8leIPYxgIPH5kpqS+k4BbIfVIWKIxQKRwKjypM9rYjh0frgow6xdf0bSi9Ln4lDUdtzCSh9rKvcagqCo/p+nlacUCm5oz4dYNnXnxEHuIslV5SUMvy8nq4HBxEA8e0DlYQOY5s+rE0cRaDhTfaUsZZBLST+mrkfnotl63acpGovCyteCJ/5zLTiGj88kfF5NIf1VQ791qT6GOgcj/Abj24A0Dc47QGfZwRvXw7cWebPVrIT0O4iBpBeQ+9StxqAbJwtkYHB6Q8hBIbQmJ+0CgGou5L3EwtLVxPDDMfT4tFPd37FUeHJNZEfw5dRwpVLJI5tWASg5xGrxCLiv/bu6HmuWrnsUGEWq3klzxEZv6eyau9f/V7pgpP2DHi6Rsntjm,iv:RIjS12Cpvbz44eHAquO74+ZG/Rm9ZRR3JtdzXGBlwzc=,tag:o0S5p29F5sTH2d08cx3pPw==,type:str]
        key: ENC[AES256_GCM,data:5wlf0ZRb7yUnF2wSl1OBe5YWYJ0FNizy9cy1XXN3diLTGMpBIHumoPVCuDy7zqJFD5aJ4q756QBc4O51Umzv9WN34ViiyslEmInp/6BZ9YmerY8IjG7gz/0kAq0BE4kHLT+XjoAKoQRE+u4vf1QxgKIqeI+sc9o8Zw5WZ0BRdAp6Lz5MafnUxgd1FySFiPZ/J1nEl+HNM36WT1899h4ZlVcpDtX/k4Nd2QkyhpAiyheST7qw,iv:OWQkTLcM4GafpOWgDLWMuNaO/0BcCLEy9TEM30Z/HuE=,tag:rYoOFRNcx+Y4lwkgqug2Ig==,type:str]
    certSANs:
        - 172.16.11.20
        - 127.0.0.1
    kubelet:
        image: ghcr.io/siderolabs/kubelet:v1.30.3
        extraArgs:
            rotate-server-certificates: "true"
        extraMounts:
            - destination: /var/openebs/local
              type: bind
              source: /var/openebs/local
              options:
                - bind
                - rshared
                - rw
        defaultRuntimeSeccompProfileEnabled: true
        nodeIP:
            validSubnets:
                - 172.16.11.0/24
        disableManifestsDirectory: true
    network:
        hostname: p-tlx-k8s-m2.monosense.io
        interfaces:
            - interface: eth0
              ignore: true
            - interface: bond0
              bond:
                interfaces: []
                deviceSelectors:
                    - hardwareAddr: ec:0d:9a:00:27:90
                    - hardwareAddr: ec:0d:9a:00:27:91
                mode: active-backup
                miimon: 100
              mtu: 9000
              dhcp: true
              vip:
                ip: 172.16.11.20
        nameservers:
            - 172.16.11.9
            - 172.16.11.11
        extraHostEntries:
            - ip: 172.16.11.20
              aliases:
                - k8s.monosense.io
                - main.monosense.io
        disableSearchDomain: true
    install:
        disk: /dev/sda
        extraKernelArgs:
            - net.ifnames=0
            - mitigations=off
            - module_blacklist=e1000e
            - talos.logging.kernel=udp://vector.monosense.io:6001/
        image: factory.talos.dev/installer/43b764902da02dc235cdb9bd53b143114b6d7f0aed6d9e4dec656ea7c8de94c2:v1.7.6
        wipe: false
    files:
        - content: |-
            [plugins]
              [plugins."io.containerd.grpc.v1.cri"]
                enable_unprivileged_ports = true
                enable_unprivileged_icmp = true
              [plugins."io.containerd.grpc.v1.cri".containerd]
                discard_unpacked_layers = false
              [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
                discard_unpacked_layers = false
          permissions: 0
          path: /etc/cri/conf.d/20-customization.part
          op: create
        - content: |-
            [ NFSMount_Global_Options ]
            nfsvers=4.2
            hard=True
            noatime=True
            nodiratime=True
            rsize=131072
            wsize=131072
            nconnect=8
          permissions: 420
          path: /etc/nfsmount.conf
          op: overwrite
    time:
        disabled: false
        servers:
            - 172.16.11.254
            - 172.16.11.9
            - 172.16.11.11
    sysctls:
        fs.inotify.max_user_instances: "8192"
        fs.inotify.max_user_watches: "1048576"
        kernel.randomize_va_space: "0"
        net.core.netdev_max_backlog: "30000"
        net.core.rmem_max: "67108864"
        net.core.wmem_max: "67108864"
        net.ipv4.tcp_rmem: 4096 87380 33554432
        net.ipv4.tcp_tw_reuse: "1"
        net.ipv4.tcp_window_scaling: "1"
        net.ipv4.tcp_wmem: 4096 65536 33554432
    features:
        rbac: true
        stableHostname: true
        kubernetesTalosAPIAccess:
            enabled: true
            allowedRoles:
                - os:admin
            allowedKubernetesNamespaces:
                - system-upgrade
        apidCheckExtKeyUsage: true
        diskQuotaSupport: true
        kubePrism:
            enabled: true
            port: 7445
        hostDNS:
            enabled: true
            forwardKubeDNSToHost: false
            resolveMemberNames: true
    logging:
        destinations:
            - endpoint: udp://vector.monosense.io:6002
              format: json_lines
    nodeLabels:
        topology.kubernetes.io/region: main
        topology.kubernetes.io/zone: m
cluster:
    id: ENC[AES256_GCM,data:zBw2SqyVmAXzs2/vkXBCnTl5PGXP2QVjCGvNhss2ryHBaAHJpIAkAkjv5bE=,iv:hCr2/rv0Wymtf+bcr+DkL8byN+iOQHXFG6diQuyUGnY=,tag:HNVgZd5ESBjTy+uxQgrXgQ==,type:str]
    secret: ENC[AES256_GCM,data:G5bd7y4SKMB0dQR7fz9uWBlCFk6VmqqY+qziqImQUmaR66MQlMa69bICLAw=,iv:8RkQNyct9DPHGTmbxpRkBv3hSEmD/ithZuBALRBqrg4=,tag:iST3BH7zptjghtOuXmnATw==,type:str]
    controlPlane:
        endpoint: https://k8s.monosense.io:6443
    clusterName: main
    network:
        cni:
            name: none
        dnsDomain: cluster.local
        podSubnets:
            - 10.42.0.0/16
        serviceSubnets:
            - 10.43.0.0/16
    token: ENC[AES256_GCM,data:eptzahKPC3dVaEFD89ThSOWRsfAkQ88=,iv:TJNesbfIXIYjCyE8A3lXPq405H1RfZGEi7y0h5M7/r4=,tag:xrH2w3a4GM6qfq6wZMgMpA==,type:str]
    secretboxEncryptionSecret: ENC[AES256_GCM,data:hocBMjPfpfbmcMa3m2OSVaBfHzTZPAfeMzbEbVjIKBcKtBSrdrmXH2+0vu0=,iv:PbYdpj2SEbj9PusTZ0YecKioZdqxN06F2bVYXcqWS8U=,tag:jsVC8mbG8fe8c33ZIk/PcQ==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:iu3yKNvcLFsykZpDScQaie6nNdhoE5qHJbbGxFjoQrinlrRlHO0EKzcQzHkrkdHOACNEHC+OrXftNQatPMfrZWsHRksgl9Kj+yFxX/oqrCxRAgyXVgMzXfhBnxIgIcKP/2GPWzWldCvmjqko5Zo8hFYrYrRQKpmIknmxRc37J7vOIHRjxSHYvUBtz2MmERNB+O4XH9U8EKSitGG4WuWZf/loiFCuxvhFWB1Uhz84LXbPIQH1OxJUUsyM9nMFUQgG/zUQMZPiFqruQNSdCFDz9A9ZhTMYSD2VxeOaZ7ELGomaRWMYqnjSfwZPLDRz2fjiuRkYsLQGsw8ucdbuleJVOJmbQsZfzR0wiDTk1eI60uR2erE+KxmoDdxC3hoY0AN1BYY3RrPpysM6BEjx4gV4kHJWFnE30XH2ohF6rXN3oUPix+GE9sy8qfVEelUW5C7iUeS8EZOgqDe16Njt2lGSP2mWM4vdgn0qShL70VU7rO+giYLDVqfFlNV5NdDxpdUwr4fX26imfCjbUhyt+ydKA/1apww+13yxW4rIq5AQcj7iBAHFLfJU5nOoTMiwSqh+tfaUHJ3CkBadGYf3bQp6cuTslPoNZvdMeSjRhUru4f1W0YyhzYxAVSwpTyq2bmE3G0FTPx/Cvp/EzCaB895dl0secE9gSGHT6ZxrCMBCHzxD4/Xp7BGizoXrZmHrUU4jUQ1uWVNVaOELsqdlIqfLqn0d3ORzcG5l1MLii/bs9V8+bu8VaUPaxeJy5Eo3jDku+V2zIG7G+km8KVizWxTP/RUrb7lBbg/Uh2VcgvvujmdCRiIUponTJgh8zPHv4q0Hyc02jMXfwmDgxTCKiOhrtv5Oz1tuRFTRFD/omsICyLGQT3uTCpns8yvPd7X6p3wkco64MzfUnH6/pjcCBPeeVE2SGIu8AkCN+kbybCiT+ZUX2g0lRBo+bpxe8KBf7WVL/d+pYpbxTm499Cun7MUvBSBtbvSceEAIpqelCBsHIpkKuhjTkZ4XdJb+c2KqPCKeLMm3ZcokmkMB9ex+UXEhULEnYVEKcolWF3Tkbw==,iv:f4yxyY/CeQ5bLSK79BCxOZ0w1+e+DKNpgDD6ykA3vFk=,tag:rhwYBTuot4b4FIe069pmSw==,type:str]
        key: ENC[AES256_GCM,data:i7cEMLPNK/D3tdRNK5RGPY3bVj1N/AZwK/Ob3J4A8ifJq2Yp7clm44Ygv1BfmYzw/HXiJjkEtlKOArFupHnBdT99KnDmrJ9YOXwKN0OdqjTiGKE6cZA7uuXIRHM762uDdXcv9vK9aHN71FkNT1qy+zhp2Z7DEx+ZVJemfo6rYzsABT5ixRmNIDtsx63ffRNGjj8G/ITc48i4X+Kj2/kzjwXPL0xaaLU3uVkKTcBRn6fPf8npA9kX0TmLtcLgSbMT7pMd5ZPaOn90Ow0FOFKKL6CHE0Qy9Iy9bvWdfcdA8bzL8CExZHTNgGqA4OS6EjESsRZ3LO+Q+UkbL9zJ8P2mcfLWXpMAAJJUyY3wF0+g1DqmrnMlHl8vPd0NZ48AYftqEtlBzsvjeF4sA4Rc08CM/w==,iv:XakDxG2cNpT5zrhrqYvukmn/i+EF3bs9vhWryKyVEzc=,tag:QSemqALjXAiclH7jMtgF4g==,type:str]
    aggregatorCA:
        crt: ENC[AES256_GCM,data:OlGhu9AFFdt0KAq+OwffyFRzB33uIDahFl1/5ceXOJ/T9E6rdp5GJPfPMoAgkF3pfO+x6KyPMG1zi8Gz2Eh6VcjnjO7cAnBm9BfAftGlpKkB2jiClnhDlLPVhYshEevQSLond/kt2hnDSkts6HCvQBjfLHmNQdB3o5XrbjVNgnlV/GukB2MpA112q0qfW+QgukT3IUllaXeGj0yVWDqsFW+MPImd+kabCpR8CnYwl638B/Nn1VrLRLTaF1O8IRut18zdpHpHyrSqE3X9uu2kUysrizqv3LPHAzncZ9eaan5nHfNJN5GoZUWtvI/CUHQaOrSMQuU97/+K5TDp7HyTHkLjE7nebK96Th7jeHytBww0RuPkee1mYkFRf8faqCpHungTP+/zvTq+RvxcY9Bnsm6Ffa6j0ICekEPchdmJScPQAvxUKLEzwjxjw91hHDpAFIlqbFvu+fEuFKc7s/u9kDcFYxjBn/nORf4QhB/9ERVKV7zS31OilNyVgcabzi65UGXu7OfiRL2mZEXKkcn/tcyKsQdsJF+ZCBk6IsYSMYBpe+3zzZnBrlV5jqY3XgJsBUL/83dGah2VKCKDBjgmquaDjkSGW+C7rN28lDKojKn+lc//8g6tgYpvbdlSH6Gxk1+VlJbT+QcaPSVCGwoVu0q4m5P2vkZ7cH6DWWhCYnLZQjq6TuVepsFTp3SpqTZx+2bzI5m60eB89BVbHS8M1/LJ03YtDtzp99a6Ax/jxv2dYhGfGtv91Hn5tVKeGYFmQo3JcD/0Avyb7wkfM4r0oqHoeHnL/RX0tJOm73o8nqMVPwRJY1/H8rem7u7IiFVUYnlUxi32l2CICzBYS7+xK2VvYcsnOEKWfJIpvgpB0Yq9hhs0xBvCtbw7LATr7P3xj48sKdB24NfNaRjZRfvLbJdmM8sPYniGzFqzPC/XSr/76f3bmCOaoRn2ysHyAiom,iv:QtLiobjBdIgYhVh/NkOUfCbtiAAsBqAIlVhtMLG8W7s=,tag:xra9qzG5jieDpUNZsoJ14g==,type:str]
        key: ENC[AES256_GCM,data:6ZzzQhNXWzLuFZCUCSLfHaV1DRAVzEg06ZfY/WCvQetiiQD6hfbWU+CPucFyNI9lzYHXDQrm9Is/F3w27lfbW0FdHjLiK5A+1Z+srKeRoKeQMgtJN+gPN5XTKfC95RkValWQl4ZhozDJS4UQMLrQrBjdDfk4o6drpF5FSnRXh+C8sPx8B1gdVAsQpKRXPo1tJAE7/IqhkpMcdgAhKsZP6K1de6oWbXYlV5LN9n/OKc/dkPFYlFhiQu4omMfUN3lLzoPVEDBy0f938tRZEmXhU5lAkroqwBmwLyKwf5Efzg9IBIUVxOIvHCLllxGAUR1tf9S+buVznv3LoP9y5zdMvV9e+jRUDLQq36zpRe7ATW+BdYkosEh8V6TlvRRJkEGscYtBVpM/wWrwCbiITOxCuw==,iv:oYjW/hC7KBpmIJXNDRNOv6zWkkPe1fAypXy9xdB5OWE=,tag:9/MKbMx96ZmZmCi8kfR7PA==,type:str]
    serviceAccount:
        key: ENC[AES256_GCM,data:7fieJoZbkXFgR/gerzDTO3TRGMwNSXMQ4LOCTQ+0nomh2xCagz5wFAFHoPeG/saj7JxRmsq2zjpKJeaeSqlZb/j09woyH6g86FhhvlgMfPPfe4Ph2NlpwQNOQoK8Bhw9Y9F3oAsdcgNLWMEZ6rrWs1AXmwUCir7yYcs+c6LBXbKJ8G3VKkuRPAdJWDbX2DpklolaTHOu+eUcxn3XZl4I0cunOExuuCo/5NomNhsJQ1QQm6wQzMRDS/Pcmji7/4C1Tpi9N0Qguc5gMdi6NhOT/Q9i8yPB9JIIaOVCQRAp6LR04mG3j3d+FwlLYQGK16LLWJeTAXPdiZwwsLEPPtE9H5C4JvybiAwHVREVbp3pgdgvuTXBIzPLeO42/nrdRTDa8K/HRsvV60jt3GWRnSbY+A==,iv:O6AzrPvS1J0T+mPST6Pm+mPIquaGfvc+IAa3pIswvSs=,tag:LI6VuFPsR/qxzMT2g2VfMg==,type:str]
    apiServer:
        image: registry.k8s.io/kube-apiserver:v1.30.3
        certSANs:
            - k8s.monosense.io
            - 172.16.11.20
            - 127.0.0.1
        disablePodSecurityPolicy: true
        auditPolicy:
            apiVersion: audit.k8s.io/v1
            kind: Policy
            rules:
                - level: Metadata
    controllerManager:
        image: registry.k8s.io/kube-controller-manager:v1.30.3
        extraArgs:
            bind-address: 0.0.0.0
    proxy:
        disabled: true
        image: registry.k8s.io/kube-proxy:v1.30.3
    scheduler:
        image: registry.k8s.io/kube-scheduler:v1.30.3
        extraArgs:
            bind-address: 0.0.0.0
    discovery:
        enabled: true
        registries:
            kubernetes:
                disabled: false
            service:
                disabled: false
    etcd:
        ca:
            crt: ENC[AES256_GCM,data:6cWNzDQkOQC3ISqiDluJCa+rqnC/D/xyq4R8aj7bBtQs4CSW4BNeGVc/p1EhF6sB+Ud0r3EPBzdhWsUK3pelObTHh8LMfrl/uoOPWx+UPuFOIFGZ6eg32gAzmhx5Jd3U+16FL6QUSNpgmQYRdCl8v2R33LUMMdQC5pWix6VxvMW9KO5f/HhVL/IQDiV5boGPPp9ZRQGXqV2T1LicjrqpZSrMRqpu/mThmC5Eqs5EN7DDLFDyZQDdA9WYhRN68m6aQVZbod64dKp/+MST03JVIPvqjnsrsD8hsomv8dsetQmTY0Kw2slYdlLWdkGK5U5dArAp3NHD3pEds4Y4QgTAnulvibON0kLikpYaxPuO2ATmc635Hn8G5qFi91cp7MvRLA60YWas5gi0wmYkCDOgFEItD8guA/K4p+DkQb+Xc+SwFTPMaZ9kZfofn4PpZFSB9eHd/XD3cMMfm5OSR7YIpHIyMPvPpqQWG8J/yVk/iZvoM031o/WXVfHCeRfKNCtMe9duUn/eLhq0qyLkgHPhNb9kzR86GzVrLw8MkoBiForM4BVbEjm/X2eHoXkHfYelP1YgXAArpQgjNcfoLc4VYj8BK6TN5beGAqoBV7/OgvXCKuzDvKMywEeXyWjQ3KDK3UtmNBKDSJqtOPbwhqSBnJNiX0CFSbZsWzwqCpPQ/syPoEoNiqHWDmIahsg/JuUkknjLh+Uj8gWY90jmwaVTKkMlnHKJEVaLNTA0zEtJqrvpH73uVBmGN/uqifnNJ41PPaOraFAM8it7vcLSjXxNxiOwX9rW0t2QArmYCONKzMoOVwcDTH1t+O3vWQMSA2qigdFpU2QnTVqeb78VmHFfLOrAGUtDpQPmyQwukAt6AclJTgmjd/CGrCrKF/L33S7jD7uK/+SdsXy3hZahnf+0ZteqA8Hf1KrH1oOv/IVIQh10fqTmjNUJzixjw5IB/0U/Mja4QfXtk155wPy4lTuJK7CG4BRHqyBoGGWuJPPMmP3INItYU7ZBy6VzBXt+OMNfhoYPYA==,iv:xPNh1qz8dR51vs6zASVFfWZLttmLojAzF09U8NrJx8s=,tag:9AYK0cGeV9KBL7HAvVF9bA==,type:str]
            key: ENC[AES256_GCM,data:E1AcEaZGPixOctOKQUZVpq2klY+oeGV7EjXBuMHwclvebw3DcfCbmepwG0/4F50jcTH8fJHD3FFMEkHDE16PIkZgAHmMvorIxysCSa9Gmh5tspraLlh8vlq7e6sepQGrhdEVy0xNq/0sqF2uUNW0RdgGVb9C5vPQrfRB6vRZoCl8znjK6gtlQJpDEIJ6sGPouwpuCZYXGCfGsLiRPdS7wRjaw7vutpwh+9pId3ruVYtaslklTywtHs4wNrK68/TSLJ6ivYM2QmoiCP3GQZmui0sBrGOL1IqZFUAYLefsc+/hxAEJciw8Mn3e3GFxLf0LIgmz1zOjYpyXlMzw+gPiYnm3kHlaqpQxI7YufzyBXfdLcgxQxLL4IDFKCvi4Rpn0xD11BpDDXkJuvNlPNho5FA==,iv:fCfLYT/JaGG02tKevhvrWXlRupdhLMS70bQ7mrKBhbo=,tag:n43coAkxXzDWeUtMkDamXQ==,type:str]
        extraArgs:
            listen-metrics-urls: http://0.0.0.0:2381
        advertisedSubnets:
            - 172.16.11.0/24
    coreDNS:
        disabled: true
    allowSchedulingOnMasters: true
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1j3hsfptdfsfwvkf504etjkrtmajny9csrfh5s24uqh6fchmg5dgqg087ek
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBwaXN5ZTQ5WWE1SHJLbkZC
            b211Sk83QlA4M0VDbFBmVExUWnN1S3J1MDFNCmdsRGsyUUpKSDRpNG5jMFF4OElW
            S2NQdXFZeGUyK1NKVEcvNldTZU1GUncKLS0tIHJ0VndCbzVrRXdwTUQ3TnBRRW5j
            dElrbmtIcTZSMkpTaGc5aXNRM055bzQKIy8I6VFGqqVv4Z8fQZMvdkIsFKz6MyVt
            k0l76j20OKKz/Ok1sW7fRWQPXFd1E5R+xucxn8xa5sPn+TVFDlbL8g==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-08-18T07:56:26Z"
    mac: ENC[AES256_GCM,data:RrmmIk24CrfILMoNDe4w+22Sv1XC21U2zhQC8k+EzfCnVonWRHwmgQ94/B+45IzYy1V4NaRgdeSkOE/xgE/Cymzw7kZDXuz1P6GuIn/T+m128rvr9SOomu3wyc9nuZ0e+LbFy9GnoVAZQ4HycTXE4f7B2AW30ox6Wo9uy9mEkUk=,iv:8v/t5gJWUgjJhFAvUfscvWKhcl1ERER9a6euMGC72wc=,tag:O0I3sj7VuFJutJ03aQrpNg==,type:str]
    pgp: []
    encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
    version: 3.8.1
