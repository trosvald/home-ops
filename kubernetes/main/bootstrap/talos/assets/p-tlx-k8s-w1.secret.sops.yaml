version: v1alpha1
debug: false
persist: true
machine:
    type: worker
    token: ENC[AES256_GCM,data:eeJt6rOSWx7mKl9LFwcQgpD3YEp1P1o=,iv:y1+/tdgMPoOzV/gKz4+P/ofR08rrXvzgZ4s9tzwYSSQ=,tag:Btkz3sz9kG7UeplgItARsQ==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:vJnG7zsbVIOy0Z3jbfyADC5fpRrfgskVnJFeODGr7rnpCMlRXr2Bcshob0fe3qUkNg3grL6YUD5Wb941fv5jTlQrPyPtJFIQJi0nHtPB7bX3apnvlTGE8ElYcoEN866ojtNa+54QGOg64unlOxy+oP6YA3ky9eb918m/TgMcBpUQl7J64+h/vN7mvmkhMmib3X4SCf6jumzgdXxfzaxl4a8fu7RY7CLfY1P+qsSwRy6v+GRkBT2oqr3HFZH44BGJSB1EHTnvTle3J52Bs6yV018IsRP4qqk4nwVG2sqtuM8QEgttk4Y2V5l0BBwTrO1UL8GY134cjjMtsyyprg630CU8Kiy+JlowsqnHJ+hw7t+7aAHsy1cOk49aGKT9bOyvaWLfY4TI6wYzXovXbMet+Xsz3ZIRQ4HPon0HrfOnok2pHOPH6WjMSge/oIHJ6ZNqkhVQj/dFS3I+cpsiCRo4/9vZ/iXoxrFXXrrMNRkZAIT2UsHMCACcFSdpIDpyaBthyQRnspQ5ss2ETxFzi3qXd17iVKa5UPyckymnnscrBC14i6fYrzfND/TzI8adaqTHLUHzGA3Yj59fV8+6jgI5pqcwLEbsADTC+lP6FNqgXzTKusHDq8LgdDA92l3iH7uzM2BnTQInver+kDLG2eJy9wvgbL/MUtIpMuZW1Bb2qDgOYVMB9dvkvJy/z0UL/pJG0quFYIAR2KxrwwEg7om0+8Rd0R4Hjd61f5Qgf1c705rd2X1yawk7uWiD6L/8Er202DhqMUFDnAbuzENvfVA2oEZxCknML4t36LwbA5irZDWrZe2vnFX9pjb+OrC9a1I/XIj3z1YRjfHuXFihj5LzTEnukPx/ea7KKX9H8y0Ll2UvNsOo,iv:eeVGUylA6blxczOiSagf9FjLV0kDSUH+/wEJeR1et7A=,tag:qGd0KgpMeRuN/5co3AAE5A==,type:str]
        key: ""
    certSANs:
        - 172.16.11.20
        - 127.0.0.1
    kubelet:
        image: ghcr.io/siderolabs/kubelet:v1.30.3
        extraArgs:
            rotate-server-certificates: "true"
        defaultRuntimeSeccompProfileEnabled: true
        nodeIP:
            validSubnets:
                - 172.16.11.0/24
        disableManifestsDirectory: true
    network:
        hostname: p-tlx-k8s-w1.monosense.io
        interfaces:
            - interface: eth0
              ignore: true
            - interface: eth2
              ignore: true
            - interface: eth1
              addresses:
                - 172.16.11.7/24
              routes:
                - network: 0.0.0.0/0
                  gateway: 172.16.11.254
              vlans:
                - routes: []
                  dhcp: false
                  vlanId: 1613
                  mtu: 1500
                - routes: []
                  dhcp: false
                  vlanId: 1614
                  mtu: 1500
              mtu: 9000
              dhcp: false
        nameservers:
            - 172.16.11.9
            - 172.16.11.11
        extraHostEntries:
            - ip: 172.16.11.20
              aliases:
                - k8s.monosense.io
                - main.monosense.io
        disableSearchDomain: true
    install:
        disk: /dev/sda
        extraKernelArgs:
            - net.ifnames=0
            - mitigations=off
            - module_blacklist=e1000e
            - talos.logging.kernel=udp://vector.monosense.io:6001/
        image: factory.talos.dev/installer/43b764902da02dc235cdb9bd53b143114b6d7f0aed6d9e4dec656ea7c8de94c2:v1.7.6
        wipe: false
    files:
        - content: |-
            [plugins]
              [plugins."io.containerd.grpc.v1.cri"]
                enable_unprivileged_ports = true
                enable_unprivileged_icmp = true
              [plugins."io.containerd.grpc.v1.cri".containerd]
                discard_unpacked_layers = false
              [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
                discard_unpacked_layers = false
          permissions: 0
          path: /etc/cri/conf.d/20-customization.part
          op: create
        - content: |-
            [ NFSMount_Global_Options ]
            nfsvers=4.2
            hard=True
            noatime=True
            nodiratime=True
            rsize=131072
            wsize=131072
            nconnect=8
          permissions: 420
          path: /etc/nfsmount.conf
          op: overwrite
    time:
        disabled: false
        servers:
            - 172.16.11.254
            - 172.16.11.9
            - 172.16.11.11
    sysctls:
        fs.inotify.max_user_instances: "8192"
        fs.inotify.max_user_watches: "1048576"
        kernel.randomize_va_space: "0"
        net.core.netdev_max_backlog: "30000"
        net.core.rmem_max: "67108864"
        net.core.wmem_max: "67108864"
        net.ipv4.tcp_rmem: 4096 87380 33554432
        net.ipv4.tcp_tw_reuse: "1"
        net.ipv4.tcp_window_scaling: "1"
        net.ipv4.tcp_wmem: 4096 65536 33554432
    features:
        rbac: true
        stableHostname: true
        apidCheckExtKeyUsage: true
        diskQuotaSupport: true
        kubePrism:
            enabled: true
            port: 7445
        hostDNS:
            enabled: true
            forwardKubeDNSToHost: false
            resolveMemberNames: true
    logging:
        destinations:
            - endpoint: udp://vector.monosense.io:6002
              format: json_lines
    nodeLabels:
        topology.kubernetes.io/region: main
        topology.kubernetes.io/zone: w
cluster:
    id: ENC[AES256_GCM,data:mKf6WgBFu4ZWHtM4X/rXfTw4aXEc5czI8/oE6mj7fVauk8JsaIpHJUY4Ro0=,iv:ir4MwFjrLAvJpXhzmqbpcFWLJu58/5bypZvpZbtOETM=,tag:QZz7DBpxS6yvfeFvbltrlA==,type:str]
    secret: ENC[AES256_GCM,data:QeDuWbPAsKD0OCzACu7p2buZFAqXW3tqxyhpZJtO2EebQWJDnc9mVEE1BFk=,iv:HLE/bPDHE8kso/89Dt83rqQ3X//d+rXJijSO+e7C6TM=,tag:OipoGcQZ3f7o75qq3f/eIw==,type:str]
    controlPlane:
        endpoint: https://k8s.monosense.io:6443
    network:
        cni:
            name: none
        dnsDomain: cluster.local
        podSubnets:
            - 10.42.0.0/16
        serviceSubnets:
            - 10.43.0.0/16
    token: ENC[AES256_GCM,data:cigDoRtt7PV4f7lnPtE4ectrMJEx+Qs=,iv:3WjCNLB/BvPGlgi2qRdQies62hNnn3A+CJtE9G9X48g=,tag:VG0OcOmJOrNO3nO+0Z2/xA==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:U4zVk4dVKlHtTjR79BNKTD0ZDgfrnLvGdTMBt8hb+Z58KNCvnwF5UVZcJelPfV2SvLUemq2Ql5EFQdF6ECtSZcs4HeLBz29hBhCMLI78igfEKY9Uy3u6dw1A40MrTIOpnnSk74b8czonRZObffuUJbAD2OmxXFFgm7fx7kVVBou+jJK8l/8s96XTve7UOzR2JMYm15J309rY7O9TrbskK5rgAz68iOhiuAejhBGwbLXQFKRXfcQwzFTTsjEzm1LmwvlAVQ3IDfj3RDNTqD7ddUvBUS+yARwWaKMzMhRqS4x9yLAY9b5Cu7XmH73O+dEfdcbP84TeMHI2+bedh6yf1HQDkJ8YEQI+9lo6U1nQXb0kzCNUNGmIv0CMBZ1tT4+ZzmWIKHGvfGPMQX9HIwURE7BvjaAtWkuV6MfJ4oovcTXjyvmmFWOnkD1K0SqrRkRw+K3/ho3ls3NTZEWgPtWxU/sd+OA9KA+jOzdoxRnaZQgLHkV6fdVO72X5YUhVtyaMiMD3fk3lHbro6vtfsQbAXqNbjiNxVOcWXo+F+4czdKcPxwXRBDShHs7mYn6QGI8TNqGnobo5JmsWcv02AJyLiGLIbTTL/dlI1ZT268xtZwpU9Hx+BKPRehFvt7Ax3tAP0LJo7cbbZZnpqSHvUKFKaWKRnA3I0mmitK81HsOntgN1nyd92nYHwX/RRXgYwlbZjqAjFUjrpIY85Sp01RuEww2edyogeIkn1qCVkpsiW2LKR52VTlmRaHHIWWQIAPloTaj+2ceixk3ZTqty8lonq/icjSAiVtpQ+gOtJmu3uu1fE+Lp2N81R9RaUyd9pSnholloUmGj8t9OBd571/+btCat0B+IoTiJ8OTNqoQs+/3oJ8wgQti9F8bHE79RWqLTVxiWXkVqwlVgoi8VBeBoA5QByN6tFHP+89bz4Li595ryeD1AS23O+vIJoS3KG3UtM+OuBIe/BGGf13+WHiEa+tUlQYuLMoqrFc1hZzT5Pn4qcWRs5Damu2G8bE/arzn/VLslP3r/duasM2bLBouZfMRZcMtSqwTCad3R2w==,iv:HhxLTrEwcWdNJanP3GtAo666b4Lg44xtFrWP+chXZEU=,tag:6vyHDmzC2sqFj9zz2OYFpg==,type:str]
        key: ""
    discovery:
        enabled: true
        registries:
            kubernetes:
                disabled: false
            service:
                disabled: false
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1j3hsfptdfsfwvkf504etjkrtmajny9csrfh5s24uqh6fchmg5dgqg087ek
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBiajlyNDdNNkZ4S1p1ZWlj
            bDI5MWx6UlNDSmRIekxrNjlHaFJubEFjbEZZCnFHL0M3cTQrRFhtSEprZGVmNW9W
            dERJWTMxM0xGS3NBN3R0UnJFNmMrV2cKLS0tIFFIWXUyM25sd2cvNVIwZDFDeTJz
            a2ltVDl3dGZSUkVjczhLc0dhbmgvOG8KuivKAAh1XV2fQ8uCmTbD8alaPXsJN1VO
            S0/vG0S8cFh/Yb9vg4YqjYg6wGm6/z+xW78rhpkweudoiebtOAJc9g==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-09-09T02:02:00Z"
    mac: ENC[AES256_GCM,data:yEcQ6j6b2BQfRt2rk+sgDPfa844sdlGY7aKzDRIX0Z6Vm9EfhtKKijwD6+oNH3bFaTkpl7H3Htbk2l+2H3aRL7dKpRDoNpGMo4FCG9seXsn7eXE5z5OLVGqubfTKslgH8CSgQbl3nByThoQ9219C7vx6JNXWV8KTyRJ7ucf1yUQ=,iv:sZp2jm/yeBFw0QD9cpUXWaxOZJPjfOyT73Qt/mIAyZ8=,tag:V5nxjMM79tHEg3hKepZBtw==,type:str]
    pgp: []
    encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
    version: 3.8.1
