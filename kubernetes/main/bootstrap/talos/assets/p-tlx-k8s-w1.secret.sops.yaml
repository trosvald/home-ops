version: v1alpha1
debug: false
persist: true
machine:
    type: worker
    token: ENC[AES256_GCM,data:WU3GyoWCM/5WoqW/0T2mqKO/xrcofVA=,iv:TLfjVkvmBGwRSJ/b/hIDjLD8ZzR+RpI3GSoYQPOADPM=,tag:KRHbxGfzPJpbs0G7LLouYQ==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:mSJQoS3I+wrSNuA0gGSXd0O6MFyNCprJtXiPeGQsBPhVxSj7sQqNWenBoNhsLWkgRwMkD/2gCLMkPtBMIoDvDORGggrisITIlGFbRFp9v3zEVjVWCzJap5qIr8BOIg5J3Tg8IvB8fWx6OVYhovfs3az4XCHCBfgt+oMotqDONAkUb5O7nodt/7Z3Cp95Jk9WZMUHSbe2O7PeU4tVVvHcGqercCjQk/QqTRMU2ziEMC+VDXevYGMT9jaDmZJ1Ltv8cV616UG48RyX4lKsqncO6b2gCmzrJgP8gD2upLSBEZOMKyREDTrCobnmsaOvRsxDpFln8bhcmuQWfoGVVNocjk8bkkaybUd+igijQCGEUEuoyYEOxhinB5XFnp/r74Q+Cqw5DUjcymMMdY9bcgfT5DfRPLl0qkH0Hj/rxpkkx/QBlCNAhTEV9HbV5DaaYJsw39oiXf1pem+WiDra3efbXOkfFRbC13s6SaOn/h6YaFOqPsG3vX28L233AX1YF0hLPsYKbQ//gQtZpHkoMVnimudiCQ0az9K0CtUQScUTSGG8WAL20h6EttA2KRXVDEgMXYX7aqPSPdlBnH3dfALWlf8k7b1jjHFLCBImgOh0P3Cm1Fg7s4gXeg4gdx0zwFaoC5a+IfK7TO+/cWPBLKvHz8X3WtJPdYhqfTc40jsIhkL++8IsojrHykaeWRXqBAkuN+96GneW4yM8r5aV2gb6LT/7cDI5ZYobs3FIuktRhmvpemEXNTGynkGUedm1fSWkEwCV8t4bTa+i0X3CLLxlvJ5VpIjlZ9P1xkF0sd03iiFv4cX2MOQa4ls76hdov5MgRMpwpH0ad3kKcxym8BmeJ+s+ccC4UUqwK97uP3R9nW0pkGUv,iv:ZePSGX47VfKwUVRac1+Y3iKGY16XQzXT0qdT6Nrh4JE=,tag:uVHs53fXb39INEli6gQMzA==,type:str]
        key: ""
    certSANs:
        - 172.16.11.20
        - 127.0.0.1
    kubelet:
        image: ghcr.io/siderolabs/kubelet:v1.30.3
        extraArgs:
            rotate-server-certificates: "true"
        defaultRuntimeSeccompProfileEnabled: true
        nodeIP:
            validSubnets:
                - 172.16.11.0/24
        disableManifestsDirectory: true
    network:
        hostname: p-tlx-k8s-w1.monosense.io
        interfaces:
            - interface: eth0
              ignore: true
            - interface: bond0
              bond:
                interfaces: []
                deviceSelectors:
                    - hardwareAddr: e4:1d:79:67:75:95
                    - hardwareAddr: e4:1d:79:67:75:96
                mode: active-backup
                miimon: 100
              vlans:
                - addresses:
                    - 172.16.13.7/24
                  routes: []
                  dhcp: false
                  vlanId: 1613
                  mtu: 1500
                - addresses:
                    - 172.16.14.7/24
                  routes: []
                  dhcp: false
                  vlanId: 1614
                  mtu: 1500
              mtu: 9000
              dhcp: true
        nameservers:
            - 172.16.11.9
            - 172.16.11.11
        extraHostEntries:
            - ip: 172.16.11.20
              aliases:
                - k8s.monosense.io
                - main.monosense.io
        disableSearchDomain: true
    install:
        disk: /dev/sda
        extraKernelArgs:
            - net.ifnames=0
            - mitigations=off
            - module_blacklist=e1000e
            - talos.logging.kernel=udp://vector.monosense.io:6001/
        image: factory.talos.dev/installer/43b764902da02dc235cdb9bd53b143114b6d7f0aed6d9e4dec656ea7c8de94c2:v1.7.6
        wipe: false
    files:
        - content: |-
            [plugins]
              [plugins."io.containerd.grpc.v1.cri"]
                enable_unprivileged_ports = true
                enable_unprivileged_icmp = true
              [plugins."io.containerd.grpc.v1.cri".containerd]
                discard_unpacked_layers = false
              [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
                discard_unpacked_layers = false
          permissions: 0
          path: /etc/cri/conf.d/20-customization.part
          op: create
        - content: |-
            [ NFSMount_Global_Options ]
            nfsvers=4.2
            hard=True
            noatime=True
            nodiratime=True
            rsize=131072
            wsize=131072
            nconnect=8
          permissions: 420
          path: /etc/nfsmount.conf
          op: overwrite
    time:
        disabled: false
        servers:
            - 172.16.11.254
            - 172.16.11.9
            - 172.16.11.11
    sysctls:
        fs.inotify.max_user_instances: "8192"
        fs.inotify.max_user_watches: "1048576"
        kernel.randomize_va_space: "0"
        net.core.netdev_max_backlog: "30000"
        net.core.rmem_max: "67108864"
        net.core.wmem_max: "67108864"
        net.ipv4.tcp_rmem: 4096 87380 33554432
        net.ipv4.tcp_tw_reuse: "1"
        net.ipv4.tcp_window_scaling: "1"
        net.ipv4.tcp_wmem: 4096 65536 33554432
    features:
        rbac: true
        stableHostname: true
        apidCheckExtKeyUsage: true
        diskQuotaSupport: true
        kubePrism:
            enabled: true
            port: 7445
        hostDNS:
            enabled: true
            forwardKubeDNSToHost: false
            resolveMemberNames: true
    logging:
        destinations:
            - endpoint: udp://vector.monosense.io:6002
              format: json_lines
    nodeLabels:
        topology.kubernetes.io/region: main
        topology.kubernetes.io/zone: w
cluster:
    id: ENC[AES256_GCM,data:9GYhH1Po+XRRJrDet8iNBnDRsnUbCb176Ex1R8pBEaRcLZn1rFLtiSOsixE=,iv:eU3aiWL6Eu7egDr/ISZMC2t3R7qsARcgGzU+jH5Ko2M=,tag:zvs4J2cyaF8NildKTqDDbg==,type:str]
    secret: ENC[AES256_GCM,data:QfPCNAtsFjpezODCMZCRsX3e5a6WciDD9StpeaqO7EzoeHrfQ+el2R0e6GU=,iv:Quo2JrDtDrHy+h1g+6pp/yYlhUwFx19Elm+h0XIrLf4=,tag:H9KINk7w75Hd+uQpPKwWsA==,type:str]
    controlPlane:
        endpoint: https://k8s.monosense.io:6443
    network:
        cni:
            name: none
        dnsDomain: cluster.local
        podSubnets:
            - 10.42.0.0/16
        serviceSubnets:
            - 10.43.0.0/16
    token: ENC[AES256_GCM,data:zbZksAF1BqjjNDOhg7/hWoOrHPJQdL8=,iv:2y0dTdl53k1BKLFvKQF6LE/H5/t/hdJxCQDr9vAM45E=,tag:KRQztC4QTthSeBa2HeWNyA==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:R6ZLyrW8EAC3hzOrpDkSSUb01k98sjB/3FhZP3QS/t/1/wZXGTWzSNqc+s0aeU5no00YUvGFZSjQkhU+R9XvrJG0icqyYwKy7AoYzWSEyTZHXWl6m+MtIX0F1OH+QfcPtXd8/VAiDuxJE58Tn3WdW/kJi//L+HpwycFRaLpGhf0yLt/X8Ju5tIi+yZHFylugm4OnMIz2PWLsOnHMWsZvMJUfUczCisuBUbR+ls75CKAqG1qPAqcu+ecRH9TDzUE9LzkVgNWEZ6bDuneq73Nn/MyAXgqwAgzUp1EUmj2K+wiFM91hKBKWIZA/c7w08VNJ9urRHr05LB+93KZN7V/9UJPiqC+XJtUf4ALHUVUgta6NapkxMaz9fqvVKCfIhrTBDNUVpAmGuI3DvMzoC4DkYihWE8EQ1dPwiVGIWexGfW487ijsx31BTYSLfM/Kz93Td8takrKSQQ9XGPc7tOkyjpUbKOyp8kxLWzRECWdvv3ZoYDCvrTb85Hcu+c0nZpsGMT4uDAn9mrPDDkwlh32BhvjwdG0Ue9I6tEk2vMXYr5BTmZQQTt4le+F2O+ULxIwaUXGxOQnDOzVuEOcoSAPuHDl90hthVBxDhpHfCVTCOccYOhyS0iXVdld+2WJDcTU95Aw4vPeVKktHJUUbVTW4LVwmbZZFOMHELqSGsGGehErE1cOw/BWeManH6vhfZ+WB95ec7gXFk/Z4ftZlqFQU2hFBD/FGQT5LhmVzDCmHJLll5/ePGDT9/isALcT4Z7dMBmyVm5KwjH05cWePGBIwrZnKSeNvonYP5+quzzt7yRosg3DSOc0RQjKIBLCz3ILRC60PfWoZdN+vaJ+NiKAxTB8y+BlqCTP/2JqY7nJ6WkiIg8Goo3765rgk4bUZBdSYFI2bkybg88JPB01Nt1J7sYq3YtQwaaYWGAO9zGa3QVqFrrXRbhYtkQjsYD6mxVgEuWysGPGq/Ji1dOv3ssu9ZSgljoB5q3RqzyW9jMECyCFrUYZgERWstayfGnYt13yL3eTpNTgouJ3DQgsbvsyMbwatBR3GrCU8XGrRoA==,iv:T/SB9joP2GjEgUFzzDwpWpUplmvuQoOQylbXXcQYxVI=,tag:X/Bxh+TXb1LwRPb9x43pLw==,type:str]
        key: ""
    discovery:
        enabled: true
        registries:
            kubernetes:
                disabled: false
            service:
                disabled: false
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1j3hsfptdfsfwvkf504etjkrtmajny9csrfh5s24uqh6fchmg5dgqg087ek
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBCVE55c1I4MUVDUGlsUEQ2
            MlkvMzFTNmNkMnVJNHBtdU01WGZWeFIxNWhZCkIveTJtclJWTXEvbm5TRDBIemJi
            RG5qMFM5YUNpTjVHS1ZKUDQxSmxQbUUKLS0tIDBOcGRuZVY0TWZwY2NDL1FrSEZY
            elBvQ3VabDdNdDc0c0F5S1RjTE9TRWcK1WPoYQfN/x+4UO062ja/zDecgJwd5XzD
            a997FIfL8p/W3PLInXWFgM4LRtg3qyDmnabm5hkt/cX1gZNYK6gIIQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-09-08T03:00:00Z"
    mac: ENC[AES256_GCM,data:AunL8fMZy8Gj7BH2HNTsHhORuonTWoJa7Lv1uMVoTGNT++C96VNbrEyRJ1WQca2A/3m5J+H/hVelCJrMNCm1422C+766yUjI1MIb2toJflxj2lcIdxfQZQZK+0s7cNJfB64HyBZtjrPRY7Yily82ak3+I6eYaER1DTCTwe2P8nU=,iv:NaxhTNW9/w4othlbWvH0pjsgxWgS9wLjfiRMXx7x+D4=,tag:+HqppBMkX4no+E4Ye0kasQ==,type:str]
    pgp: []
    encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
    version: 3.8.1
