version: v1alpha1
debug: false
persist: true
machine:
    type: controlplane
    token: ENC[AES256_GCM,data:zsT7CSB8maceGt457pByv/Ll7+l27W8=,iv:kJv+08FWOuVeFtPatPp20fov9d6boW4v32PBYBbs9Vo=,tag:+HFbV54JqPJb/lH5126dMA==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:NWKkFqfTCpu3uc3iqkYsD63Zmj1hXjbrgfoBDRrq/97gDlv27lZ01x4QbfiGhlmRah7IxHJpB6H/RbxA/LWRwufDagpwuUf/E1yiU/LHi40LnEbS4gGZpYb8GfH2WPgpSYo0boR1lhbPsIZT/iaXJ9dictIaQZbbnyHwKIqxpt3MM/QvRHKHYNjmLJ6S9oJ2YuwFrbg/Ti6MvcqjO5jTJG1U+YGKpDuhmf5pZtoerFvMdP7IXKG7yWVQ8K0STlPRqcYiT5S0P7ZfABSxAk+GnmDsbPtT5+rXrEve90x+C2fHAZKBv6OAQ0tCAN/+r12mPagRML8Ywm34qgGVeTrCc3M2z5Bb55Nrlgdx6rwxLSY6eUeWK83g/vLP44kxuIEPbZXNZrowYIeUA3yc5FNIQq8JcFbAYua38sozRRF5IL6V19JYGq6TTMIcEl1wFFWhDhRjfK0RhydmTJyALhnm+54WlmfN8AtuR4O+w4OItpeaBszSqvhWaJOTQ1/AfS5Z0GT+dd90qYlqzWEiim7ejI5cvV4Y6euMuxNLpQXQCOrsg5jV+3556kETxjD8n/fN7YHnW3/qiAalglr+QQQLLtC4vRQBi4cvE8zPAnB+l7Gdvk3WvH3TeE+6/jCUZAP0mV/PqYUmir1AlJFrPLIQlzYmomVQMaBHwsUN2OFpt5a3hhzgos+0ouP58pNQ3+Els6YeSLA3Bk6gk46Rn71mWIW/4zN1Ly9YGQl1Pc2bFjovKmqa5oHKBwJmRsh8qp8FxSQ5LuQBIdxgWnQ7gfYQl1wr/X2SuvL9JIK+N4eS4pgn7vL9wKwl90hC8ojjPILvaLrm4cUh4C9TT9m29KAzESswoH/d/ZnQrPLdfIOJ9R9C7y6B,iv:jGEWh+S4a/znGfW6RmOf0khK0MjjYpkeK7U8qWwRioE=,tag:AtTQ9r2hqPmQmHGw6EAZpQ==,type:str]
        key: ENC[AES256_GCM,data:+GdIGSLPdwuMAui9epiWzd00q/En4lKNj9QTiYtvWubVstEamBbDpvF5RKUboDMV2C/XpDBN/aQJa2mC1HyQE5lV/nMunYETUdTpNbPFp3d+/7d1VSaMpcdosde1ITIbykcSkKTsrh8jXR8lAgLINHW+ie59PvvYaL8Nr7lHHKLISmZG9vctgZfAsuAAhsLAfZaA5XzKqFXHvevP7IbJwoKL7B3Zz0r2e+XlzPVlR4hQNl4I,iv:OGSn7AhSxgCGmTm9zEFoLRLWjDzo37ojxhmAxhP9CvA=,tag:xkT0bnDSn7OM/rpcTjLeXQ==,type:str]
    certSANs:
        - 172.16.11.20
        - 127.0.0.1
    kubelet:
        image: ghcr.io/siderolabs/kubelet:v1.30.3
        extraArgs:
            rotate-server-certificates: "true"
        defaultRuntimeSeccompProfileEnabled: true
        nodeIP:
            validSubnets:
                - 172.16.11.0/24
        disableManifestsDirectory: true
    network:
        hostname: p-tlx-k8s-m1.monosense.io
        interfaces:
            - interface: eth0
              ignore: true
            - interface: bond0
              bond:
                interfaces: []
                deviceSelectors:
                    - hardwareAddr: ec:0d:9a:02:85:30
                    - hardwareAddr: ec:0d:9a:02:85:31
                mode: active-backup
                miimon: 100
              vlans:
                - addresses:
                    - 172.16.13.4/24
                  routes: []
                  dhcp: false
                  vlanId: 1613
                  mtu: 1500
                - addresses:
                    - 172.16.14.4/24
                  routes: []
                  dhcp: false
                  vlanId: 1614
                  mtu: 1500
              mtu: 9000
              dhcp: true
              vip:
                ip: 172.16.11.20
        nameservers:
            - 172.16.11.9
            - 172.16.11.11
        extraHostEntries:
            - ip: 172.16.11.20
              aliases:
                - k8s.monosense.io
                - main.monosense.io
        disableSearchDomain: true
    install:
        disk: /dev/sda
        extraKernelArgs:
            - net.ifnames=0
            - mitigations=off
            - module_blacklist=e1000e
            - talos.logging.kernel=udp://vector.monosense.io:6001/
        image: factory.talos.dev/installer/43b764902da02dc235cdb9bd53b143114b6d7f0aed6d9e4dec656ea7c8de94c2:v1.7.6
        wipe: false
    files:
        - content: |-
            [plugins]
              [plugins."io.containerd.grpc.v1.cri"]
                enable_unprivileged_ports = true
                enable_unprivileged_icmp = true
              [plugins."io.containerd.grpc.v1.cri".containerd]
                discard_unpacked_layers = false
              [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
                discard_unpacked_layers = false
          permissions: 0
          path: /etc/cri/conf.d/20-customization.part
          op: create
        - content: |-
            [ NFSMount_Global_Options ]
            nfsvers=4.2
            hard=True
            noatime=True
            nodiratime=True
            rsize=131072
            wsize=131072
            nconnect=8
          permissions: 420
          path: /etc/nfsmount.conf
          op: overwrite
    time:
        disabled: false
        servers:
            - 172.16.11.254
            - 172.16.11.9
            - 172.16.11.11
    sysctls:
        fs.inotify.max_user_instances: "8192"
        fs.inotify.max_user_watches: "1048576"
        kernel.randomize_va_space: "0"
        net.core.netdev_max_backlog: "30000"
        net.core.rmem_max: "67108864"
        net.core.wmem_max: "67108864"
        net.ipv4.tcp_rmem: 4096 87380 33554432
        net.ipv4.tcp_tw_reuse: "1"
        net.ipv4.tcp_window_scaling: "1"
        net.ipv4.tcp_wmem: 4096 65536 33554432
    features:
        rbac: true
        stableHostname: true
        kubernetesTalosAPIAccess:
            enabled: true
            allowedRoles:
                - os:admin
            allowedKubernetesNamespaces:
                - system-upgrade
        apidCheckExtKeyUsage: true
        diskQuotaSupport: true
        kubePrism:
            enabled: true
            port: 7445
        hostDNS:
            enabled: true
            forwardKubeDNSToHost: false
            resolveMemberNames: true
    logging:
        destinations:
            - endpoint: udp://vector.monosense.io:6002
              format: json_lines
    nodeLabels:
        topology.kubernetes.io/region: main
        topology.kubernetes.io/zone: m
cluster:
    id: ENC[AES256_GCM,data:gjrm2WwnZx0e/aPxlhqZx+nxVOKMFQ5Zv/mfsTxoNvvGsF3aVBossQ/NJUE=,iv:FnE8BEi0OUGTYksO2eae1fYll1oKG86E24oO4Icnqus=,tag:dVhRybvN7Nlvc/db7KPF8A==,type:str]
    secret: ENC[AES256_GCM,data:m3gG0uvzQ8S4EJfFcPPuAgSurrEXx3Wrqlvvsr6KUr7Cf1HkXvdXcUFo40k=,iv:1r+HngFBn5G3fyXq+YZXRJX+mtd0JhrkM+xoyGyrlUM=,tag:xdIS/+L70ZKQQxQJb/WZ0A==,type:str]
    controlPlane:
        endpoint: https://k8s.monosense.io:6443
    clusterName: main
    network:
        cni:
            name: none
        dnsDomain: cluster.local
        podSubnets:
            - 10.42.0.0/16
        serviceSubnets:
            - 10.43.0.0/16
    token: ENC[AES256_GCM,data:jyP9UOyP2zV/yvI0t2l1y7lEUFPocvE=,iv:GederedW8r1zwiJWjc+mbf7XrUB2D5HEZf2mzQtVlGE=,tag:n0NQ1tCYfmCBk2lJz4fvtQ==,type:str]
    secretboxEncryptionSecret: ENC[AES256_GCM,data:SS6e6zsRFsEZl42vS2VvIY/Ri7MCgaXB/uLhdYQfW5/U95osWkLz9Omst+c=,iv:IGjiT0dJiR5fhehyRxNai1dZcnBkXkF1xry04zA6E+M=,tag:CtMAVc0VRtmJvAETkuBsOw==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:JMatDfD4yOO6TiQDlN0xbZBHjjo9W1DvvK40X6X5VGZ/SWqDNcoQFE4pmmuJox0O614SqEnt9MUTui77aL/aLqTaf2Eg6oBivu2QAq5E5mQJXhJzbl/S6rGI7nJSJ5LlfDNrbzhrhdVibawR+yvi277cwF8vn1dr4xKkUw9UkFcg/Psn4EW9M8QBWzvAy9GIpzm1DjpjwCElr6BTsvSVQtrWb7yzC/yvvAB45jEwFNqUeMdbUFn84VrR8hhh49kxXCxNW/hpdTHZgdwdmR2qArlgYAuuSH9xDRDMcgLkFDtqxeg1mi6V4hfMeYTU+r3zcOcIobmzK8e4zjOn5QKdwwUtuP+dR3I/ouL6ChXadDamy2Hxn392WphUCs0Pt30fbHHzvvHCEsta1qmgYWvYdv6n1BwoSKK1aElvdcjXkqQ71mp7I/zYGUCtVYliXthisVtiqZHkK0g85rvJQLOqTu+60Yj26G8FJIs+Pq3+MjeD8R5G9PFY5ss2PxyerY9/O+JS9lVVo4klOHcvc6ibH3ZDqu8fDrEuzJapa214QAo1cXa7y4Ql+T63iavZo31oHfDUYxtY8kGh8T0GQFmTTTlwbGaioAf1UVNBNqUZFsOyJwoOSa8A2KOEQeFgJanLuONiYbBZp0ErApfccPSO0tp5dvLNPemaRlced5MW+7tk3AxFGajRzVbuTpjG9N8N3s96xsWryIQZRaCAGXqOidFKNARif4ES1V0OqEbRrdDIcr1Y3oKxcmDuxVfjdvCWan5YLMnvJ+uyfenXAGSDTm+BpISJcR4FVl9ulTeQ62Nf65/5j+pLo5waG1yQzSPGJch6RbAu4OI98362DLSO1cEH5Uz/Yof9z6p2Y+1LXfrJ/YE+GYOvFjndlChn6yjc3wZgIyVQ1oxjvd/2svLvFAbY0WLn0xIc+XNCxXee/w0BgOZETpt5ewwTd6eP6Bb4dkcgGmYOh5Zp5pnIusyooNuyj6GjXwFqs5FeCU3H+N37ils7xTZ0uvoF4wWqS1hm8tCyJ4RkqO7eDvVVSp0etBuNPgXHL/7XEjbRNQ==,iv:pqAPaRqsVPOZLq15s70w1GPDlQveBVbKxVCbufbEVHA=,tag:j5ZiUhV/SJTRkCfQtgWokg==,type:str]
        key: ENC[AES256_GCM,data:SQO16qhK9WEDqFZAgO9qV4xtbaKTxhz46c5EtzWe9Ia+P6spHlW4hCNITaxCNDMeMtJKvDyH4mD3A+IThLGPie1AyJC4m5XMRUK29PXF/IRWO/qhyo22Gu0Ch143RQ1StIOQj925TPuoatyakBWCtOL33c+t+V9dt0AcnLJ7YycOhsXZeZAnRnufGlvsuLGOHusLvtx7kkd6XL1O654p2V3RsgmTQJSgwXmU7NCtn0EK+GVSiANdtxIMsJWlgoytGgYCNz62V22xaGoEbfZpa+X6QSjTC0hgWWFg/4Nv8X25L4NcQiX8dxPK5cZdNrjLFlJVaLHzfN9Vk/q+caSuZScSRqNTM3bERB9CAyejpNRUVYZ7z6Uv9837Sju1Arx9e7zPlUroxndLMwT9oi2KIA==,iv:PedHFYDLM29ajQZGR7z3b4C+nzCZS0pG+2P4KkA4uKc=,tag:7GcDYV2TfFPGdZdb6hH8tA==,type:str]
    aggregatorCA:
        crt: ENC[AES256_GCM,data:7TgsT9S+eHKFP/E6yjVXg8+w8t//8LgUQsdx2xYrqS8MiDDj553fUv9LS+6CC7vpVkaOMnmNxL2y/TFKod9bfkjig7tpq/Nr20LR1WaPMLTbM0kH0Mq4n1DCosf0rJIpDZDiwj0QMT6E2TYFu2VOly3Cdevt7sKtlJATRHrjyKyndX7K4yiON2ClTUME70QT3DupKbwwES0rgkz+LXc7Nxd7emJKqKJmH8Vzr4f1nDzoN/qwJDAwWbG0cVpbSugoTcjyfmislvVV7ugqRZZcVxqV6nBfVEEql/uIEQHqTRqhMrdFReOoedIxthaPTCBBziqAfRd9XCGFJwiTGSfYl9QTdtafJWGN2qVx6Qph43NanHoMhfNx41SL3FPsUCP1CrZ2bFSimKYK8YNCxfndoYlZ4Sq8pVmHMz6FuYJi3Q3LurrPX2v+0DQCfyH1oxKi7qWdQfhZA6Ax2MewmUn41k26QXkEZFKJaXH9HKaEaQRBdOUj9CBGBc6tXXxh/rGbor438Dpptd1meeQcb01BG00CvL9Vx3+DfHhnthsp2sEVbZpsplBVV0gE+m6ZGK1LwB01LeZXNsYjbS76nXAY+B8+36ADIZ4+AjcLaH3fAGd7MjlKeEuZWyT32Y5jCNDwdXR0EuqwBCOemtMFyYFVar0W1+UMJttwRV0r9dl+1Y4K6pqckGbPv3lOmXY3CcIrr7lPW3vkamyTPpMjpBKMZoeJCCYXo4cYGowQdAfXUZwBLOP0XlofaB5u0opLDUc0uiWp+Bzo8cZmGZL155dYBKR1jtWZsf12y6aHloGJdCyJifek87jFrUz9iq6v70smi10qmhzQhOX4PA7WqDxLI560QeR6YZArWeuyx/eQJu+1gvj4tlz+Icjif3IVcgliXJ5nkJM3JHD4YImGucUbJZmD/ezAC5fvQx902UpmnW1jcISP2BLGib0/8zdwi3n6,iv:1tD/wb1HaGOMX3kk2FSCvo/Tw6EMPd/JXBjlm9K1nqk=,tag:gBESdiX5vkeL+SlbY8Mbvg==,type:str]
        key: ENC[AES256_GCM,data:XeWrJtsmtyWujTqjZJLzs7uC/PdvOQKmqi+TOTgDEsVLiO35PD5FmxP/8pcGzQajLfunk87kYHfMWsA/3KNM1FK/F1MhZItOGOZ9hlV/TP+7rIO9OfzGvzG9Vm9MT7ZwFZAe9xC63cqrdj6wK5aU6EkSqfPw65fq1pAEpUpjBk+ww2a9O3EkDLLHAr651bui6fEiDX9yo8bH3PYx6+5F5Z0pX2kjrz2X6nsR6IuPqHkLhiF9hKxRaZVyPNx/4BSYM7dvoUPULu0NHpGYUb2ok/KoQa/KCy8WBB3VP6O3s3mZ0pg2sitCRhQy9FDdsynlEyy53l3JdUg0Repg718WWiQQD92uN81ftZspAGq+/V8M3eBBXr1FhdMUN5E1UBf3beIFEE2NlPR2f/sILIYuWw==,iv:K5UVwoZMFvGMgM9+0Nk9eRTvuH4ZM0m6c340vuSipj4=,tag:qsmHhA/Vvh2vy+7DYi+GEA==,type:str]
    serviceAccount:
        key: ENC[AES256_GCM,data:uFYAIOWr2+SOkQMlzeaaXxUxsOvkaxvBE4V01cor4JatvfhXJF57vwx+d7H7huPANm/o620PFZfe5wFzFPY8IWe3l2mFmkAU/vtoDpDnOuXI5e89Un0+ur3nLhdc+zM3IcqxZRFJ67lxwmV2x63e7T3taC9yQJI4f0fCIaEYJis5hwStlylJK7LGed+LqfdP6hB0vSZT+OnK0fznKL++SR/chCb6wo1DYCu4x9JiIf43wTjWvfh79KIj9iuCN1EXTq6IZP8E+ihVOrAmlyL/5o39/X8WDky212UO9r+yHR/1ER/HIX5HgMLXzy6mOYWOUJ6IjLsQffMY21THYnhYniBGZNgPUQRxSyCzyA4AmdexssDJAgWwH3gurCOn1L1WABfEx55eMkHR63+1sTgTvQ==,iv:DY8qNHEJqOcNuzpX+wdVk+yMsmO9U1JUZKl6HwEB6zI=,tag:9VmTKLkgBSLrTrLNzwnjOQ==,type:str]
    apiServer:
        image: registry.k8s.io/kube-apiserver:v1.30.3
        certSANs:
            - k8s.monosense.io
            - 172.16.11.20
            - 127.0.0.1
        disablePodSecurityPolicy: true
        auditPolicy:
            apiVersion: audit.k8s.io/v1
            kind: Policy
            rules:
                - level: Metadata
    controllerManager:
        image: registry.k8s.io/kube-controller-manager:v1.30.3
        extraArgs:
            bind-address: 0.0.0.0
    proxy:
        disabled: true
        image: registry.k8s.io/kube-proxy:v1.30.3
    scheduler:
        image: registry.k8s.io/kube-scheduler:v1.30.3
        extraArgs:
            bind-address: 0.0.0.0
    discovery:
        enabled: true
        registries:
            kubernetes:
                disabled: false
            service:
                disabled: false
    etcd:
        ca:
            crt: ENC[AES256_GCM,data:AhrC6eZHoM6hHJqECnz3x/UnN8s/KNL6lWdky5+NGJ6EROUymNMkf558WcOG9sPEF8qPuDkstPOV5Fk3V94QBeSiVt8lS61xx7ZEjm9DdI8ZJtfwQDezQRq6rkMlIib70ltZ8fIBUmqbJ2kVZzVgNGDZtwdkNzg1ADoDTMXYrJGLNmm68c5AsgFdEbeCu94O9yEVElNPa0XrwZKONlL5EWbLvAudOy5xR5aeBtP4IXMGdUusUta9qqNtDN+kbGFoQR/k9faqP/ByTOJ8XssnNa9RhxuSuSwyI+toJhDTgLfRXGv9mOoNwJpl/wdMLS7a7qYpH4fyq+TJ0KWjO2sTiupar89y5yZhJwuEEyCNB5Za9z2baq2kWXST+opK+nrrKWcEDTtoE+O08SZJuuOhgBMaw52OU+qSNqmOB7NsgNtmAiWLVzDx9dC6xWSvWWXtZA1DazO9jmztdoUsxJHcqMwGsbXp2NvTYCYNZRT8PcDRJkx6LsLxCs10/feG1dkFUijJVmlu5A2WJgFRaoA3DbUNpOyAG3KT5I7+dad7J08BXmoVaSLAQ/CecIGSjONY5nGESMIWcsov3IiLXRejGGmNe4wGI6Dn9HUuJMAdgUmWqBYbWJi8/OoPPHdqmzl5GUATEPXvsTJPM14nUtblM3bi+95nzCynwIVe5Fyr/e91uQkj/W37zEAy/Tr4rWQ/CyRLbuaQspyFFx8zwkgTbZ46SVv+Ikjzqo2JCcYTdREtWiMNuIldjuLZuG5wV10XpOZ6Y9dAdqlPBDUuwrkVTIMSS556pZFd45TH7LvHtPjJ8eyndRfjuHkBYrFFZBCfCr8Tm6a/xCdxteavUc625U4eYH2ZaKztOfcps/OyV82IbQY9bLypGdnrW3omgZxVrhqYTNfQsmzfBQUdV4rDg4Ud2u5umUTsIJW47MpxzbbBCsKr2ARYrpZGAfDk+omxitLsi9HneQwXInEtlMvOivpZ6ub0Hs9BORDzn1werudEU96h9ETgYfA3/N4lFZvRVDbWTQ==,iv:14isM+VoWngWhu403ZNwxubjoRnih4DZrlwGGlJuY8k=,tag:mN9b6chkfl+ni0j4hqJxRA==,type:str]
            key: ENC[AES256_GCM,data:uLYIN5MUSZtYdWH0Rk8sRARrQPA+s4gyTytF7th6QaTuBspAEgHi6qM0TY3uIuWT9iFqay93oC7uX6LN77N5+2gs+bHDlPujEOf5e6V9ZNhQuRjch+XO0x7MjKOhKh68CnfW6xOHddEXqUsuj6IYqkei91cg071NnqXSp8Ak5shoX/U+rLVI3Yw7sBfZgM0mzqG0RQG2ESse2Ocivzu3sd7OsW0ghyN+dpTX/RIUsmzyeL0lRRuERxjR86DWk1Na+5xaWa8Rohfz9CHUDsQhBZN8ctJWl7Z1YmWk8m4hnq5Uuy4QotBYZ4sGZFeitXmHM9WqzO9OxcSN0lIR686aeK1tCWQAo2E7/568aNYcSZXs6Ypt4gVaHQ3MZbAUZMjiA0IsZtSX0gzl23eltrLugQ==,iv:ezAqlWFCWxRHsvQOkBfJZvQNpks63J7/Swq8rQwPrtU=,tag:JzuI6mfFxT6FAKlj6P6luQ==,type:str]
        extraArgs:
            listen-metrics-urls: http://0.0.0.0:2381
        advertisedSubnets:
            - 172.16.11.0/24
    coreDNS:
        disabled: true
    allowSchedulingOnMasters: true
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1j3hsfptdfsfwvkf504etjkrtmajny9csrfh5s24uqh6fchmg5dgqg087ek
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBWQVIyVnBhYmxVN2Zrcitt
            bTJmYWptRUdnMzFMQlNPek5tRDJkbFZiRjE0CnQ3NWU3Ym1KeFVGMktmZUkzRTd2
            SUVvaE16UnRjMC9NZ3hJbzhJdDdicDQKLS0tIG0zZ1Mwb3AvN0lya3pGdE9UTDB4
            cVlyS0FkVlpyMnI0QmxRV1FLU3RSYkEK2ckPMjsRVUpAUMDvgaqjpfbwr0tGgjMs
            vs13zhK28Y0LGUnPwWKbJpgpn9LPesEyZxOAKU2uBB9QIu+fPoUS7g==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-09-08T03:00:00Z"
    mac: ENC[AES256_GCM,data:Npn/vCofc8PtigatwaCliTsgGffvwaTI1PfHhnw/Y9YsugtQ76B+pofM+hrwCq5ijywmXwjEXozmxrL155acN+k0mrNJ7OeJNnOnhRc/hZ+NQGPzwj9wxRZ5TGKvAgi77r/dQOyx61WqotCVIZG+xSFh4DwIU2yF2423+xSWv/0=,iv:nudw0E6iK0nxrcuSFSprIP4hF0MAEEM8LewxoJsEgrA=,tag:KoEVfmMME8O8HK6kAEnxFw==,type:str]
    pgp: []
    encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
    version: 3.8.1
