version: v1alpha1
debug: false
persist: true
machine:
    type: controlplane
    token: ENC[AES256_GCM,data:0Ra5RkIUR72pFFMTUDSSSr6THEqTqzU=,iv:7PiYDXqAK/riRln/h3+03jU7Az8Fa3AIvRRc8H4QMko=,tag:b8g34Is2LrOZf1kxD2EVbg==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:v8FtBpKbftHejq/bxgbZ/APdbJgbv3PSYnq1uCUO90+RwrgmzCHv8gyG8ktqN6zhv3LXpnY2GwBLdBWadYvdNR5A6uSKfwxVg8zQzZ6JaTtJwBn3CqC0CX4APUP02v5AtFWsq3MGN/n7M99IZ/xF6rTMHondj79U1+SbVIY4BBKJgFWIZQJ5KRYjcHXE1dDjuWdJDXL30HdHIMDlnhkgvHYjQeMJ3gdhwQjjKoQkzSfqbUUNsv5E3Xyrze2kstwdmZwth1FWbcxoCutSakBB8h3rWnGwyXc+L2VxBMYbF/YVJuzau45HLOHUAHTm33dgW29BDtCTtyRpd8oTUWJv/xXpTr3SwzMuOkLzRp/YxlxubMM4HDsfTNiJsrXPHxfwaOQZkWZc58yKcWFXcRQSgvUKnpWuRIQ9zFaW0yeWtsvo7fOnkh9vF4kkTbunYaudFS/9VllzDApf/MpoTGceysoYMm/NPJDFnEKSQ0SXdmwGcp9SdPwmnvZTVjALvurf0zHtqkvGc3aX1Htf1Lec0twZ/blZDBmh9CVpGXYlx1u0l74Mv7op52+1aXj8/MSRbn1q54fnM4QJa5lFNImM2CSm7+p/pXgg8jtEkUpvwcSNswgn4YByJ/RFXrQoGfiBT9xzmb1k7OksdaX81hqIQC/O1+430iajKGgVc06siPNF/FVrY9W5jxLfeXX2b5UIZzE5Dd5dzVzHUfefaItjXc/qF4m308as5bbAe7WslQfxxjZ3ExJoo8UtkOEkpHbCRnaJ9HKDl4ZxaU5wkwuVjDzwWI9adowZpt42xWkDi/lnR2KkfnaCjwDTKQY51j9H7nf01LIOOwp3iWU62Gy2XLPiozXVjk/6CXA1nmju1X5s826O,iv:Zy2BPbhmaJthm16C2GRDiwHHs9gHx5mrYaguXoe9k+U=,tag:a/dxTRrk7m49fd51VWPrjg==,type:str]
        key: ENC[AES256_GCM,data:qby31FMExFwj2WtCNPR9u022eZ5YBfhAGEq55tnBxKtEcPqFTdQrqtaGzUObYL8TIwVb2G/EY8eLYbL1pASS+F569EPX8KYVgVUYqGWtYhoJQq7Rjc2+/cszrgs5Cdf0shH6bXLDNYVxd3codGMsKea/epSQWbJe4Jv8YXMhy6KY9PLjttGfPVJ6Mm+nyQbwZLhAlvM+rYSy9Gv2unQAHjiDUGWMRSzQ7+jI6pOKwhKXwA89,iv:IIxShDo9t8cBnVBwxlaW9G9JmmHM1ctLUunjG/sxmrc=,tag:QNxMMSkfdQSdr3HKt700+Q==,type:str]
    certSANs:
        - 172.16.11.20
        - 127.0.0.1
    kubelet:
        image: ghcr.io/siderolabs/kubelet:v1.30.3
        extraArgs:
            rotate-server-certificates: "true"
        defaultRuntimeSeccompProfileEnabled: true
        nodeIP:
            validSubnets:
                - 172.16.11.0/24
        disableManifestsDirectory: true
    network:
        hostname: p-tlx-k8s-m1.monosense.io
        interfaces:
            - interface: eth0
              ignore: true
            - interface: bond0
              bond:
                interfaces: []
                deviceSelectors:
                    - hardwareAddr: ec:0d:9a:02:85:30
                    - hardwareAddr: ec:0d:9a:02:85:31
                mode: active-backup
                miimon: 100
              mtu: 9000
              dhcp: true
              vip:
                ip: 172.16.11.20
        nameservers:
            - 172.16.11.9
            - 172.16.11.11
        extraHostEntries:
            - ip: 172.16.11.20
              aliases:
                - k8s.monosense.io
                - main.monosense.io
        disableSearchDomain: true
    install:
        disk: /dev/sda
        extraKernelArgs:
            - net.ifnames=0
            - mitigations=off
            - module_blacklist=e1000e
            - talos.logging.kernel=udp://vector.monosense.io:6001/
        image: factory.talos.dev/installer/43b764902da02dc235cdb9bd53b143114b6d7f0aed6d9e4dec656ea7c8de94c2:v1.7.6
        wipe: false
    files:
        - content: |-
            [plugins]
              [plugins."io.containerd.grpc.v1.cri"]
                enable_unprivileged_ports = true
                enable_unprivileged_icmp = true
              [plugins."io.containerd.grpc.v1.cri".containerd]
                discard_unpacked_layers = false
              [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
                discard_unpacked_layers = false
          permissions: 0
          path: /etc/cri/conf.d/20-customization.part
          op: create
        - content: |-
            [ NFSMount_Global_Options ]
            nfsvers=4.2
            hard=True
            noatime=True
            nodiratime=True
            rsize=131072
            wsize=131072
            nconnect=8
          permissions: 420
          path: /etc/nfsmount.conf
          op: overwrite
    time:
        disabled: false
        servers:
            - 172.16.11.254
            - 172.16.11.9
            - 172.16.11.11
    sysctls:
        fs.inotify.max_user_instances: "8192"
        fs.inotify.max_user_watches: "1048576"
        kernel.randomize_va_space: "0"
        net.core.netdev_max_backlog: "30000"
        net.core.rmem_max: "67108864"
        net.core.wmem_max: "67108864"
        net.ipv4.tcp_rmem: 4096 87380 33554432
        net.ipv4.tcp_tw_reuse: "1"
        net.ipv4.tcp_window_scaling: "1"
        net.ipv4.tcp_wmem: 4096 65536 33554432
    features:
        rbac: true
        stableHostname: true
        kubernetesTalosAPIAccess:
            enabled: true
            allowedRoles:
                - os:admin
            allowedKubernetesNamespaces:
                - system-upgrade
        apidCheckExtKeyUsage: true
        diskQuotaSupport: true
        kubePrism:
            enabled: true
            port: 7445
        hostDNS:
            enabled: true
            forwardKubeDNSToHost: false
            resolveMemberNames: true
    logging:
        destinations:
            - endpoint: udp://vector.monosense.io:6002
              format: json_lines
    nodeLabels:
        topology.kubernetes.io/region: main
        topology.kubernetes.io/zone: m
cluster:
    id: ENC[AES256_GCM,data:1mMlafc1xWu/cJRINEbVh4qGadHb9jc9ihFg+y/NUapacxd2z44U+DcMvto=,iv:4prhK4PJeue+sWasYdNL648m694Zr5l7eSO4+XvJnbQ=,tag:VaXmfPmQGdJ5ENcVyHNpFQ==,type:str]
    secret: ENC[AES256_GCM,data:bhfhUtNcEVOXMa/P24HwGOco+UP+AGPouoFczv5tZ6lccNEDeSJW9sW/waY=,iv:fioPxlm1tPo6bf8z3NF11VOHenR6n9MQA5ef2/YnsUY=,tag:kSt56uUP3W1IJHF+/1QsaQ==,type:str]
    controlPlane:
        endpoint: https://k8s.monosense.io:6443
    clusterName: main
    network:
        cni:
            name: none
        dnsDomain: cluster.local
        podSubnets:
            - 10.42.0.0/16
        serviceSubnets:
            - 10.43.0.0/16
    token: ENC[AES256_GCM,data:Ezp7qbqj+qOmzNm80MvdarDn9K7ktRc=,iv:1jLsOWEPC1StqoD73nFARRy7/S5dV8ijZHp5ov4NzOU=,tag:YNsGHaDoMbwsPNn9ft7Juw==,type:str]
    secretboxEncryptionSecret: ENC[AES256_GCM,data:MxQ1hyV/HzKQDMxduSihLI8EUreSUqfroNHd8YfaTcwnDHzmJP28Yh5aLTE=,iv:0ZbZzp6Yxb9XYQUZ4k9ptF78cP3zaVr8mNN654Sn/ro=,tag:UtosKOfe8UY3kS6t1qyOeA==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:bd/J3TnxXyDeJtCDDbxBZe2n8YQorfRhYAlda8zpzM03EIrRywzEEDsIgjqsa4AhYhCwBXTfpqOoK35kNwWBEaBeCQSC3FuPrJnIhf9jOYhHny37LlMk31ZWI0CJ26EKor19mRzKtys1E26DIxPQjHkWNzSRGjQB2hVWs2WFMjgRg1nCdqg72eYeO9go+LI6y37XuIbqZtvnn67Fa1VJnci/iIY5pO2EDs7uZyhH/4mhLxtz1o/bxQ1Boa8if6A1zp/PSeIuFIrGvfBqvCSOQfmNuFyuqS0HCcr9e7toEvtbnhaW0/aFKpRQwavElcL5sL6Xff+o3HJMdRKerVDMog7jmYoSgfmMo1+WIPv6RWa1TXVDm9LvgkRR3p64xANF8/IqICC4Hw+x1AoeQuzhaEvda2DNvbwlxlBE/jBjLuJNrkK369haVbJ58gl2lXVzQ82+l/1wz6Tm9slxyyIb/sWBRzkOdGkl2dy6lvKCMYMVnpnecVE2yA70XWAQ8jd7b3M4u8IVzWz2fiwJv8U9cFpwMtFnsSkloswurJ6YSOfSUJWtguT6iTTMRIkl4vPI9qZO3+MKPjJGrv3aPxcOpX06Dacy91ByhMxqsEPInYo4XDMMHILhdkrv9imir5uW1d0k2QRb8kNCW9JsHUS/PfJ3xwN8Pt5ULDmEPr1hxRk5k6JVBCJv17WRi441f8u+tMrls3RXTt4o6Kt6D7LzgdwzuKDAOauhV7Sp6FtTnX7b2wbjB9yS1OS68D3faWwl/uf95LXz3pwFFPZcIy2n431pKna/Ev3wXKjjxVjGt5Q0o/1Jcio/n3oI43elVdRO282dE+Ty/EprQsriYmdeSNwrSNjKgH94C+4ohC+i4UAKcz4+JqOqCgeRlIh212Cy+9PlzV7rPR9k9wv6NxxPcdOhQ8jqS4OvWSjymnGgU/xPWjmGBXq0LXcbciBqCrY8auGgsE7LDLEy5Y4DBFNKg9nGiqfSY+idUAA8UvCnQAgw62g/G4qeQLMtQoUdea+bgpQkwrLwhZe/0HWIft0HRkAL1d0YFNzW2x77ng==,iv:vzZrimff/5+/nX42b9CML3e28Pd80DrbAaVefZ2HJos=,tag:/ScWq4YAEnUXifSll0pm+Q==,type:str]
        key: ENC[AES256_GCM,data:OD0yNcSgNHoyEGQOWQ0XFm1FyOzd9tIyVcEi+0+GONTXgNZyW+YGxo3FVkxlLzioaI/5WsUN05qj2HAHT/WfA7HOhJs704UlD0xTD3jvXh6bwUiN8PodfZ3W2zy36izYJK0GlvYEfVMwuM+/dzgff7kQXQnm9J5EtshnfWdv6JRzEgVIDEQCz3vHaMLwnhVeMcB/gWKgSy0acOhJmtfETbsFg/uNIYC6b50H78/fXSSyZSxHi9CEIm3Ia1TCNWHcGOAsN4gU+c7A+HDJUL0fr3v7ZMlxkWaIQ4Eh3nzrsUS3QK+QwbCWSZ1rt93NRXiexKcYnq4yYbMZeAuFUIyEZb3ovYKS44cGXVCq2H0Gq3SBz4CRT5g/tFicMivLj1gxJo+xyqvzeb/FyFu3/Xf8nw==,iv:PdOcUrCWJQmiGH55SLp7L79ZfZaE+4nQDFKyam6/Z1Q=,tag:YUSUXIOSY8rgVF/vqEhHEQ==,type:str]
    aggregatorCA:
        crt: ENC[AES256_GCM,data:PB6rqywn2Mhy/BHghzplbk4tuC1ZrKC28WBllU01aRRev5yjrngWpM7GemDpitBGtmCd5Tpiu93CTPBXYYzqAFAU1l2qFdiRTNnRLTrMk5UA9wJDK9pieq3fMv/E+LgUvye7Ba/iFF+vrqn5kqcYzzj0vFX18ulxtOOWjA8XI72iBOu8i4tNfTfpQtkeBOQm9Xfb0szCQHS+BleMplS5MWFNx2beDUQisAtJvlrYaXItgUWqdsrCGksVmPHpzIn+My55DP/VRqW5UbIn/0RDvAVgnzJqcrdjCyolhJOLQYxKcXQUdf4vPsADbsUX9xb8bZjoS7gCPXMjGmLeeOABeKsPGMjSbWuWhcwg/etNnN1ZNMfcV4K4QkeG8XSLiOcFWhKYxLlWG3PsA3omq1Pk/N7jRr8kEkfARut+jHbwaJh+HMcQYf3LdcXSsEXM3tPEWCu9IUXvHJeRNWhzVRmvTzPSbvG3Lk1uhga+UexaYau5tzPx5APXFb6KRUb/zDHa3oXLWD9UnYQyzi66pxYbF04z9N+Be9qfhI7uSNO8CfO/vCYp5JZ7tqMqUsVehc0tWyeUfkshI9vwSmnNXsx/MiKTGHNR3PzNHtBoBQpWieAdIgmXOPsZOPjH13F0whroc01/Gy87lOWMMvvb0HFFP9sy5EzUkVgSUquH2AqkjjeYqqyA0y5i+A/zC/J+17etVsE2b7228Zz81NJCj680e/SsVf9dVuKmcMh7w1tzI6iokQ2KIR1GJIBu4iNMKpr6ERaJcwbPiR63hWaZKF7CVe+aBmbBsqqT9QmTR5ZQcg0Y5yHFslScAt8HnL5UipVnnc2pvKJnrpdqbr6Yv+worl85UtnWO9DEthlDvXxYOGahjmg8ST14EcKYKIl36tfF7e57U/w9kt8EK9aGyv26P5E7WiZPudnnwU6SNFXPHV+QZfazed5bdh3ChfOICzIb,iv:GSDMU9G8gYcwzv/IuSpkZkFOgVgPGMPsSN1bcVo1Spc=,tag:Cgpl2S5qloazTv/6BuAyhg==,type:str]
        key: ENC[AES256_GCM,data:SZdQBpGNbBYG1dJcolCr1L3LqqbapYwBfjWk+f14LZKfk7h9Ojv3TG95cd99pNqA1zayz6YngA10fP9PBXlyjNV0pzF/8VAtukgW6VF4KjeGDj2oRV+T94wkfHCUP/ORIC5ZimM2POq+4R2HdK9DcVgtG8YEcjMAurhkKwbC9hR+fA4VuK9AJWLPVYMFezFCELuWtqn2jlgG+jlrsqjhF8FDl1dY6lxVXHD9eTJKHBIRKhTG22vtGx3yYmjs+aThPHYgsaVMYfM/QAWmCAsI7cUDvAeU37f+VefEKZ4Sq0AWvlddU9bZJw9eNb+by+DwX1tKuBzzixqnynhux6FWMffNA/89MyifCcA7PXBaKoJnr94ioBzKsKylF5R5W/4xaWznRzIrvyDUyeRk5iOUjw==,iv:6QkIx59QEy7qfbeCY1Sb3bPOB7Va/PIdVHxAjt238j8=,tag:RJHBKgS5l/xMfZBZfW262g==,type:str]
    serviceAccount:
        key: ENC[AES256_GCM,data:TkJqh/qP4/axB3hNwkrMP1AW5KhZhuswrNzpf6zg5NWTtqG/unCWGoW+mqjvsDkMAOdPfqQKZzoVjGG1IzxIN50VRv0FckxuvIG7lj7ejWU3hLiob9TbwsGoApCBmW/trwnvQR978OYkRgiJ9yrC5qFuiL+LnV0HQJneB5h66UAGH7/3TeI4bvxt5Wtu+66UpMCD8O0EgocNp78USV97UlsoJj55sXoeolQX/VbhogZKOOPhujFDptuN03mHez75QjYXRrAkrjeOyg4OPqpkZJmxIyRAAnH/D4J9rHWzp4u1tzDuB2iV6tTkWjbILl6L4ciCXFkkGpscHrLoSqEPu8QFeX9IJjfAsZH7D/WEG6FsiEw/Uf8SoZ/0Qb9JXOzTOuiTr6ErdJZSpRA/Sy3YdA==,iv:pgyMlXNS592QbAFrHiXLAJYINONeb4+zpZF/zW4aZhw=,tag:+lFKnq7kpzwelp7YQEW42g==,type:str]
    apiServer:
        image: registry.k8s.io/kube-apiserver:v1.30.3
        certSANs:
            - k8s.monosense.io
            - 172.16.11.20
            - 127.0.0.1
        disablePodSecurityPolicy: true
        auditPolicy:
            apiVersion: audit.k8s.io/v1
            kind: Policy
            rules:
                - level: Metadata
    controllerManager:
        image: registry.k8s.io/kube-controller-manager:v1.30.3
        extraArgs:
            bind-address: 0.0.0.0
    proxy:
        disabled: true
        image: registry.k8s.io/kube-proxy:v1.30.3
    scheduler:
        image: registry.k8s.io/kube-scheduler:v1.30.3
        extraArgs:
            bind-address: 0.0.0.0
    discovery:
        enabled: true
        registries:
            kubernetes:
                disabled: false
            service:
                disabled: false
    etcd:
        ca:
            crt: ENC[AES256_GCM,data:uirhOeJSD2W+VcORZTYj07bNVBYWEnK21sPgwR6Uxap+McO8bphMbRHIDjgB7GxzsXkqlh54AmSyXt7lL3H0e6a3+0OuxDmHpiSP1orPbtgMVhVfS7pHOz1depAEvInJF7/ZyzSdVhv/Y8Bc8otxm8pCLxFdDa3OZApDk9qh65is1PCOAlH8xk0q/4XqMtKk2EYFUBFazKJ3wHJtz50IyloHYV0yBQZTIftpoUTvb/agi4gWLYDR5Duy3kn98BdaOjsMpHjEUDwvvy02nujrWlXcJxqiIa7vs36Ipq7cdyqW1PHBs1zupefLApO8Y6iuAbn9jzYwTwcbJC4egFoh97ra7xfDEZViIa+LJriXIOMxBvknPj7aEyA4p022jFKUeIC0djDvgKgPmcm0DgoX+VOTOhKr8f2mATQbwDvhbHfPflQ9L/QOKqBts2UWifJPYnKJ+M7AuCWlsOfTgWP2fiuvL7J75qK5VCPoFVHS2ZF8UM6k1tACewnrYd5ycWt6gjCrV2E5n0ONkz5ZXGnSPZhybqQDvAWnOtiBBV6AV8MMCdIFsWmQcSdFbIUyM0ubUVJKlFDPHQCZmO0uL9a2/dM/Ju2xgJ6UaiTbdXyVSVopwPQwgD9PmGxBYtZLPieJYwiaMagvgrl/feJAdvTfcAyE3guZulk7SfDBmk7cRVciQK+Z2Pb1uvhm6krFMgZEGlgVk3jD91eDJuITF9KXQG86delcJs10Kyl3tjIjljqVhMDSuBRTuQosZ7qbb0+T5lB0zNcPEHei6t+bgCoDhjkZzCSZbYru8B2Mm6I/SOF7BQ3iB3UAgej9FOtFHWRKUebaZdTOwd+XGTxQvqq0zf/5wPLPmZIm3iXBnUohRpHEqgSTZ2GIkQYPAKh6H+BCCwfitWRZ15FzhZ1mOGhcACjCWSu3zZ1GlJS5Q+annu/i++8+tct6JLzt5CCqvts9SjGIWacyqop+p7sQQLIrZdVSw9TK40NUNrxKnnWw5az6YJcY64mzPqmYosECpxf5Y8Bfjw==,iv:sOCrQ5DUDfYSiA8XAnNkhsZiXeXZKSEpd/Iu4PvjYvU=,tag:Ta+uena4VsoiHQh77vA2LA==,type:str]
            key: ENC[AES256_GCM,data:XNHnEJMj5x5cFZmuBM1GeOQG/6xcek4gif3XC7+5PqOPl6l/fG40uiQExsWIdcS3JVfyR0oGxVZcTFUYGndg2LGelzjZOt0zQMNzBM95UV7CqGjFu38+Y1R+40LIrRS3lpEu5OHw97QZqnRINvU76YMicX/B9bWCy/TIzz25D40Xg2WULLEo+ladOcypKa1ZDe5lUE7r3aX5N1pu7QsWXNM2YdRLUZ0iim65dhN6KrYHmFhWJt+DF5ch16OLDh9o7DPTrReH1i+h8ZibK/uNtoB0UB//qJUJ1f5GGb8AS5bNO+Ju/ZwEgK8u3fZSBsYMK/Ph3KLRr+3DfoQbcN55ZJTtNVYB2KGJnG0+61N4zk7qe6ah4XqNiuEm+TVKXoA6mzXcA+RM7G301dvh93Uwaw==,iv:tiNuxcZdUgTFYpfaVc0ZHH6Xzyx2xyK7bqA5rSsbYoU=,tag:2q53r35G7xdxSvSZh6rhNA==,type:str]
        extraArgs:
            listen-metrics-urls: http://0.0.0.0:2381
        advertisedSubnets:
            - 172.16.11.0/24
    coreDNS:
        disabled: true
    allowSchedulingOnMasters: true
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1j3hsfptdfsfwvkf504etjkrtmajny9csrfh5s24uqh6fchmg5dgqg087ek
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB3MzhOT1VndW9hc09zN25a
            YVZGeENnd2JJZ3c4L3pFSHpoL3o0Ym8zZDJrCnFSU3pvcXJDc29JdVZ1YkFEK052
            SFc0ckNSY09zU04xcGZVZzNzQ0NhQXMKLS0tIFFuKzV5aHZpdVVML1N5SHdtVDNE
            S2tMeWEyakIvN3E0UTRoTDFSTlZuMEkKIM6Xw/LxT4rTkLVCL9wKolRoYCdpSD6A
            9vKaywZVDQiXcpcTAmgXoHmJytcw9sTD/ZbVTzS5sVxut/f9tErppQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-08-20T04:17:51Z"
    mac: ENC[AES256_GCM,data:EKj6vxfl3sbT0jF9XLplG8mkiej/Zn5e1KPngXo+wkNUpEULnSnCajP3kzCcafXEF+VXvTz3LCl2fiOSH9dcRWrEhzh/i7FGp8gMulymDIYjhaPiaw+pKmZFmdybaQeYv1jw+UVdcI3S6p23p9hvx0Auzf7jp/h6BKexJVQ9HWA=,iv:Hb2GNfap9o8YzRhdztaCLgOgJSg1T298eS4Q7/nUVcs=,tag:rK5ou4WXmeH05a+2PyaXtg==,type:str]
    pgp: []
    encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
    version: 3.8.1
