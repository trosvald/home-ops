version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:Qxr6vTnAyyBItxBT/GYrHnkO7KXUo2A=,iv:bo34LteWiOBW5a0XbbIjC/J+AQuiDun4HON6WIlks2Y=,tag:7ZIqIIUoV/cjG1YVMYIXjg==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:M5raa0lTB/ino2I3u2VseGfZZf/UjhgVPCywvHfq++Y8Jtgg2PJ2U/+BpqxNCLatrPXZ4o+YRquO1f3UWcQUhhPqGTZ8dC37qIZio7qPXjaYFTuSAQZacj5K82kW7ooQ7LQJR1E2wJAwf0sTj0KyyfD7mA1SurlhaC7dh+bFy5QBmzB/qfIB+WK1lKIHA2wbVW6H920rV92T/snl+pQhlI8jXUciQq/G66k5cGYlc15HcxnGGHe6mi+lv1Xcuxh7q/LAokQZAJdpCIBEQFshVOnyVqORGygdKOCntzLkAji34Ofd+7tyO9wUwLmPykf+TkPXCPHIdJBHhs/7FI7VN9FQVca7Epb9oZ7JGkP1+fQe6XincnTQPLJxSLTu4fFnA3oP9SWwoopngOaSHofvipBx2VquPOVLPYG0KiTGrQfb0skJdG8pUvpCiJUyfx0QVKk9C/D5xS+3EPT+H+y+EKgJPTdyRcA2+1Vz0l2oCz88VPvWlSeINZAOpeijIEPbegvNfvezZktnQoNUGJC+dG4GunSGPa75Kci4xJVcUBalWkVXJ9RRiila+nQ/MTtURGbm0sPLhrXQWayjxaqVDIs/UZ5aqLA/e1ZEDI2S+xmaq6ok/Fwb0MlXmJ3o+nsOLytz/FWPw7CVQMz3Edkl0VxH25YzU6/c1AuJMDjQ/RV26a/DwhOKKWLVIZkhY3pd+1fbWNbUiwwmkKiJiHM+kKk5TnCvextbIYuYBXE8eblWp6Jx8QvEzV0jYKWJY/hmUTdZ6fxsEBkij/AABA1aPfnbIqX+RLUrSONhSwyCxF1/tffXAZkz58x06sUuCFfRXqmYG456nG2oozrbfDCi1hyyAjbgcbZ06DIcPVJ1rM6bO02W,iv:Q4BEBDPDgWd+B5vcYRIuXwcPm96ELpDUhmiSztz4Vfo=,tag:D4jBezYdw7ItTQ+NwaqjdA==,type:str]
    key: ""
  certSANs:
    - 172.16.11.10
    - 127.0.0.1
  kubelet:
    image: ghcr.io/siderolabs/kubelet:${KUBERNETES_VERSION}
    extraArgs:
      rotate-server-certificates: "true"
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 172.16.11.0/24
    disableManifestsDirectory: true
  network:
    hostname: p-tlx-k8s-w2.monosense.io
    interfaces:
      - interface: eno1
        ignore: true
      - interface: enp1s0f0
        mtu: 9000
        dhcp: false
      - interface: enp1s0f1
        mtu: 9000
        dhcp: false
      - interface: bond0
        addresses:
          - 172.16.11.16/24
        routes:
          - network: 0.0.0.0/0
            gateway: 172.16.11.254
        bond:
          interfaces:
            - enp1s0f0
            - enp1s0f1
          mode: active-backup
          miimon: 100
          updelay: 100
          downdelay: 100
        vlans:
          - addresses:
              - 172.16.13.16/24
            routes: []
            dhcp: false
            vlanId: 1613
            mtu: 1500
          - addresses:
              - 172.16.14.16/24
            routes: []
            dhcp: false
            vlanId: 1614
            mtu: 1500
          - addresses:
              - 172.16.15.16/24
            routes: []
            dhcp: false
            vlanId: 1615
            mtu: 9000
        mtu: 9000
        dhcp: false
    nameservers:
      - 172.16.11.9
      - 172.16.11.102
    extraHostEntries:
      - ip: 172.16.11.10
        aliases:
          - k8s.monosense.io
          - main.monosense.io
    disableSearchDomain: true
  install:
    disk: /dev/sda
    extraKernelArgs:
      - mitigations=off
      - module_blacklist=e1000e
      - talos.logging.kernel=udp://vector.monosense.io:6001/
    image: factory.talos.dev/installer/${TALOS_SCHEMATIC_ID}:${TALOS_VERSION}
    wipe: false
  files:
    - content: |-
        [plugins]
          [plugins."io.containerd.grpc.v1.cri"]
            enable_unprivileged_ports = true
            enable_unprivileged_icmp = true
          [plugins."io.containerd.grpc.v1.cri".containerd]
            discard_unpacked_layers = false
          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
            discard_unpacked_layers = false
      permissions: 0
      path: /etc/cri/conf.d/20-customization.part
      op: create
    - content: |-
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        noatime=True
        nodiratime=True
        rsize=131072
        wsize=131072
        nconnect=8
      permissions: 420
      path: /etc/nfsmount.conf
      op: overwrite
  time:
    disabled: false
    servers:
      - 172.16.11.254
      - 172.16.11.2
      - 172.16.11.9
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    kernel.randomize_va_space: "0"
    net.core.netdev_max_backlog: "30000"
    net.core.rmem_max: "67108864"
    net.core.wmem_max: "67108864"
    net.ipv4.tcp_rmem: 4096 87380 33554432
    net.ipv4.tcp_tw_reuse: "1"
    net.ipv4.tcp_window_scaling: "1"
    net.ipv4.tcp_wmem: 4096 65536 33554432
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      forwardKubeDNSToHost: false
      resolveMemberNames: true
  logging:
    destinations:
      - endpoint: udp://vector.monosense.io:6002
        format: json_lines
  nodeLabels:
    factory.talos.dev/schematic-prefix: 03f8321e7acabf80dddbde44cb693f3c
    factory.talos.dev/schematic-suffix: d7b4d4a571bab9ae5cb74be79872a6e9
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:lfaPiPwXm0LJ7CepWPur/v3ZzUw/Qq4TsATg8E7M8+zcIVExluslhmDxPD4=,iv:9YWIKTa/boUgumjsS9WYK/908EPQU7L4FCAJwJuGIcI=,tag:nV2w2rjnnVkfwFwrYITL6w==,type:str]
  secret: ENC[AES256_GCM,data:T3SiyoQgROHwwMAouqzGFNEstQS0rcK1Uk86GTGREzATX3AFM4OOV6cvbeU=,iv:TJcBD+GVLIu/hDLt1KrL8kuRtbdDp5yQ2R5KbopXvS0=,tag:CVspIL4VmZgjlsOgtsuxcw==,type:str]
  controlPlane:
    endpoint: https://k8s.monosense.io:6443
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  token: ENC[AES256_GCM,data:Wpb5Ko1g3pkTGWbSUzjuePgE/ThxXlM=,iv:THDXQ10KJIq0yLGOHpO+728TEbha5e8DQqVVAHFeQUM=,tag:9+mhhenZstYNlIGy9qf3lg==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:4cw9vT/wB17VxL8HiRvoKK2GQ/sFOEVAf20OdDqtIiDXW+ImaAplh487Sf4GQI7mXp6ziXiGrpoYwMPNv3cIwbu+Mm58e1B6IL7ltcePDL7p/4ioRPmkYzkvYiFwCcaLWH4XMIlF6o1V8viRe6DlXNQOz6yOxKbAdoB98OR4BNOO5jl+tx8VrLuZ4e05Zpl0A7Fy/xBCAbhW41HjV0vRbey41zipR6Ra5tLju7i6Z9nTq/ARZjo0HXoq4KIfz2Wb4+RiEymdg069V/YNHdrMrMgEHLf+iPLbJ6j0BMMxLs5BhxMgDxETNeifxPayJcSNS8wC1teqVuB9ylmRPus3ouVXeymK/WrUjPJDDLdAIuImcV/0DxN4QHEhS+diYnE92ONPTwy9g4WUuKxOuf+6PjO3HKcQDLgVPOk39jHq1wWq+OIEzttB9+YjYhNm0sXNz3htsKHcWzycCuW1cAb2E4jRP4icpR+CDXAHoPHuU5W4LWVjIOQ1DCo6ACrQ1i/IJD77MEsSW/7WhVxmog21Jq8SzbgFBWLvA/k24nmYVhZsMhggqtg90PPOppSKvjpSCNgdq8Yu5AHxvWIcHksvMDxWuV3FQae0xK/JW37kmF0bVstE2jaPeiL8bC9Q2vCOVYigNRmUkCRoCa9c3DEPpjDQnjCzCGvo+W55POMwo7dwFKnLeUzeAKGBjZiYX6avesbKKhWANLrKXK/tgRVQ4keEhe5iIDhhbUXiS9XGE1IsHWZaCXwxUWlNheihtTHBCrFXO2sgOhwUAmdrPksgfO89QgyeUEjmh151YjuSUDBIYnFqjKvR6l4hSQjlVsjj6PHcp0aTa/Le2WeM+5ElRA3pUgkRUd2FCFHiHrI+2SpvpYeiyzzIghkaQri8xuBVGshi7vGZGRNR6iSY6F1hx07/rYxJ0BRTp7eaLHgKyXWeTRuWUX9imyF1aXwalY50Sa4wJM7hQuJlHahg4sEgkVmcyxOkHWdBDhCudB31KyWqJuAHEXsCz6Y/8nA09YPDdZ3Qd8m5A5tI7aQ04UxqlGKZ/yTWD12bUnx4Pw==,iv:n9ptBNSKAPO5P/7we9LaZV2ql7ULI2O+3H2SplJmCdg=,tag:J8Te/x7FZo2ZUjHyMiwJrA==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: false
      service:
        disabled: false
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age1j3hsfptdfsfwvkf504etjkrtmajny9csrfh5s24uqh6fchmg5dgqg087ek
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSA3QVV1eEpocmpiYXVrZnI5
        VXJMMGlBREsxaDNxQzBOWlN2RjlwelBsYkJNCkRGQTZpaCtXV3dua1ltem53b3Fh
        R3A1d2t2ZHFGWS9DSWFER3lFYk9QS0kKLS0tIFZyVUxENThPMTZPY1BLS20rZGJS
        d0dwY1picEVkZVo1UHpGOFZQQ2xGRVEKO6SchPejr24jR1ZThBWpkVLLD9x/VOy9
        /YnfEX/GYH3NSSN351hX5lauffCoaQGZUBMS5zXA6+mvpe3g1A6ZcA==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2024-09-17T01:37:14Z"
  mac: ENC[AES256_GCM,data:0DDYHEeKc8M+T1+bJT1RgeAufkvEv3sfJZlrfLRGC3L/GlvXrOa0olFeQsGN3H+GhMLzs8DUlMiy/HrnUTXKBBJpfXNGdRlG9+CRYIYM570X2+6fNBAvFP71SyPamo/x6htB352MRWSbvwHsyyDeGlE8G1qcKuJvz22YtidJfOA=,iv:BrjIIiW86YaMLo+Bu36P0R+NgS8/ommM7x8dWqRirjI=,tag:dd+AcvkcSzxbdV+xIxWJQw==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  version: 3.9.0
