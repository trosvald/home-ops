version: v1alpha1
debug: false
persist: true
machine:
    type: worker
    token: ENC[AES256_GCM,data:RQypSaUBoYTi6nNUV6+E7CXyQQFIgLg=,iv:pY3h9XZyTfA7NXkyVL7NlF3sVc8Jy88dtfm0I7suN38=,tag:dfWH8qN+rb6o1M2veVMzIQ==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:81OmFuWtCIycJPAtMcqLnpX6QbdGBjbhfxLGP2jlvMzSCTyI3/Qs2TVuJnqC/s2d25MSy0tX73QJhTXmgGhTC8IOXdqF789RMgEK8og3SxImjq+6g/jg8S4JJrxlypZnvOBSuVnDALCGs13L+KX0LRqrAYMxM3fCniALLtndtBq9tIF7zdgbDQU1MwO6RYBaJTThOJdkSvVlgPP/EELR7avtMB3d0g81ducC8AJ0ibImlxw273RsO6YRlobCHfjjbk+sLlILorcyUYAi0XZ8t6+0PPnAv4yvprjcQWqULcmjZCR3xuSIpYSBCnomGSpyk830yQPJ1bORvW6SYtj/zw2MhvajLzL5KiOfNNp+WveayFY8ThHVRvXWR86gMiAmn81aTAji1nGhUnC7aX4AU/P+oQPI15zBxz3vuEBSOOazm7f7FpFe5Q5A+p2MxNXeFks1rfxbW/RBwMJgvn1Pr5+LEt8ctmYjLJD+tXAqGtMIhfKF9K520bOuOhMmCm+SSy/KQMfmH8uLdjBBozfjIEb/Xm7NRQtq8bHb5EItEbelFr3N9r7dYT+03iiJTMLcwBwODgZocaVq5L/GskL9u18/gAGIY2UWqlTzbQLdr9vb5AIv8ni1R6quzJPz21OyKBrcQJg6JgPfaCnb8ikFYPoPa29gVgszK/c6BY70YLmMtqkE1WctE8ZcrjjcWI9G5NseOArg6UpDMKROqj6dx4qYvqSvHj0H1hMwxU+frzD+UQKsm9XUkF1DWwLk77Fim0SnZ3sjbqfnp4N5H/kMjZz8J0IFvj2fiK1YYBJb6UMNI+nigNSQezJOeCwYQ7JoruHbC/rcYJx1o/Ys2ovKd6q9ciQqlLRQAtuAtXnMphTustdR,iv:3H9BsxA70BVz8lJ617ompe9w8w4x0rfZKwopdvvY4Hs=,tag:FcuA+HyBNDUwdMVuSwvq5g==,type:str]
        key: ""
    certSANs:
        - 172.16.11.20
        - 127.0.0.1
    kubelet:
        image: ghcr.io/siderolabs/kubelet:v1.30.3
        extraArgs:
            rotate-server-certificates: "true"
        defaultRuntimeSeccompProfileEnabled: true
        nodeIP:
            validSubnets:
                - 172.16.11.0/24
        disableManifestsDirectory: true
    network:
        hostname: p-tlx-k8s-w2.monosense.io
        interfaces:
            - interface: eth0
              ignore: true
            - interface: eth2
              ignore: true
            - interface: eth1
              addresses:
                - 172.16.11.8/24
              routes:
                - network: 0.0.0.0/0
                  gateway: 172.16.11.254
              vlans:
                - routes: []
                  dhcp: false
                  vlanId: 1613
                  mtu: 1500
                - routes: []
                  dhcp: false
                  vlanId: 1614
                  mtu: 1500
              mtu: 9000
              dhcp: false
        nameservers:
            - 172.16.11.9
            - 172.16.11.11
        extraHostEntries:
            - ip: 172.16.11.20
              aliases:
                - k8s.monosense.io
                - main.monosense.io
        disableSearchDomain: true
    install:
        disk: /dev/sda
        extraKernelArgs:
            - net.ifnames=0
            - mitigations=off
            - module_blacklist=e1000e
            - talos.logging.kernel=udp://vector.monosense.io:6001/
        image: factory.talos.dev/installer/43b764902da02dc235cdb9bd53b143114b6d7f0aed6d9e4dec656ea7c8de94c2:v1.7.6
        wipe: false
    files:
        - content: |-
            [plugins]
              [plugins."io.containerd.grpc.v1.cri"]
                enable_unprivileged_ports = true
                enable_unprivileged_icmp = true
              [plugins."io.containerd.grpc.v1.cri".containerd]
                discard_unpacked_layers = false
              [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
                discard_unpacked_layers = false
          permissions: 0
          path: /etc/cri/conf.d/20-customization.part
          op: create
        - content: |-
            [ NFSMount_Global_Options ]
            nfsvers=4.2
            hard=True
            noatime=True
            nodiratime=True
            rsize=131072
            wsize=131072
            nconnect=8
          permissions: 420
          path: /etc/nfsmount.conf
          op: overwrite
    time:
        disabled: false
        servers:
            - 172.16.11.254
            - 172.16.11.9
            - 172.16.11.11
    sysctls:
        fs.inotify.max_user_instances: "8192"
        fs.inotify.max_user_watches: "1048576"
        kernel.randomize_va_space: "0"
        net.core.netdev_max_backlog: "30000"
        net.core.rmem_max: "67108864"
        net.core.wmem_max: "67108864"
        net.ipv4.tcp_rmem: 4096 87380 33554432
        net.ipv4.tcp_tw_reuse: "1"
        net.ipv4.tcp_window_scaling: "1"
        net.ipv4.tcp_wmem: 4096 65536 33554432
    features:
        rbac: true
        stableHostname: true
        apidCheckExtKeyUsage: true
        diskQuotaSupport: true
        kubePrism:
            enabled: true
            port: 7445
        hostDNS:
            enabled: true
            forwardKubeDNSToHost: false
            resolveMemberNames: true
    logging:
        destinations:
            - endpoint: udp://vector.monosense.io:6002
              format: json_lines
    nodeLabels:
        topology.kubernetes.io/region: main
        topology.kubernetes.io/zone: w
cluster:
    id: ENC[AES256_GCM,data:ps0f8MjusuwA6SPwvzjQTYoNmrUEvxj8WUf2HwGHq1bQUGcwieFp4D/nWVQ=,iv:YVb4JqPjzx/s1J15jJxut4XRoLZ03t5ebNKrXbsfZeQ=,tag:A2IpsvkjFnOBtHKWv0zS1g==,type:str]
    secret: ENC[AES256_GCM,data:LoItwo2+LBIFY3M7xAIgnBm0lyt0Hukd8GdfVWNeZ1Ep5dlE7GbtX26lCes=,iv:vbw+rKaNg+9DlreVuVV2QhGp0gAZH2Ri9DtLz5R2rzo=,tag:sW0jeXXuFZ+m1lqty3SbiQ==,type:str]
    controlPlane:
        endpoint: https://k8s.monosense.io:6443
    network:
        cni:
            name: none
        dnsDomain: cluster.local
        podSubnets:
            - 10.42.0.0/16
        serviceSubnets:
            - 10.43.0.0/16
    token: ENC[AES256_GCM,data:m/9hL+CpqsPWFG5qub9dSHOE9pNzqTE=,iv:4Yybw7DQKdUY0NnfUkeHKUlkUa+fJ5nedDEKXTxQFmM=,tag:WEOFaJwpJ8hcXNIWVRBIhg==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:F/dQCMC6R49M4OomUj3+i5xNovQ8Gg2srimlYVslRXB9zjH1yxFGVzZ5Y1Rxqvkqi1YtKCTUCTAg8Ykbp7+bmBBECexogO9xUwpZ3U99Nv9TIt3fGg7En9zcHefbKiSX1ARjDQ3sERBputK7dHEN08KBf1LGXB9yExG4nOoaJW2krEiwexzgkOEOeptuNyVw7sxpqbR7D+xdSJkfoN9PeHKvfjRoe0b/EgtyC5XPkoOBkn5vZ63S4hoRBfIac/0+QmC56szv2PJGKrX5zOQAQVNDafTkYXAwIcQjoYKpolG2HcP5M1574jmIC8vs5GBbZldMvOw0CHfgwmR3g2aofVBRN9eeBL4EbwR+e129ruk62l5AsNY/VyGhn4fxI3pMmykjOlMKj7vBzs2StH/fc59Rhr8WyupK2Lu/kM5SSa2Wlz1ksSQdW4m5UdfPu0g02Gq9ehck1M5TzJ4HzxGoA2sXhVwwvO3W+FvaqA5GH9gTCbgtT6qYl4GbCYBFyVJRLDlszxQ1YtSKDSAimW5snhebNvQhPLvy4SblHT0o37pRI00v+ZvCMBH51kfw4ZWiiSj5nw20Yr/q8zTqGPHqy3mWY82KzOMOsMwiJOdKz9bnpBhYSEGvs8xxCzsKu6/QISr+LZ8/RJuTeRAY6vTWyDJcl7H5BNXv94zw5b6O1KyaWUFoQ7RkN6eifOzv5MliAbhGYSo35MqZFGN6EPuHKoRqEXRPCPtv1acvoWYNSeHqSG1KALukEl3ruVX2Gx2dQy2oGMuQXU/MkSZ201jDU0/3ElP2EpuDoZp8vkvVUk1T2TOE5WF+HYquQ1QP/DGrGTcE8OnsxQrNyZIQn6pV5oxwvhhWvguOHphBS9YAapAthPUpXb5bzpdi7YwpWAGxQSPHkBnnl01hplFdcpdBXV4A3nsL4AH17AFmokp1CWFHQwwtj83evfe+b3Yk25Xru7+IkXu5WdmW1rLj4iHXlaZebhBnJrkB4gs2VPJD09/eegaYxvZ9e7Pxc2MOSNzWa6YNfz2RzoKP3ILofBOU4QSb7RgCHrHd7e2uPw==,iv:4aziEsqU9HU8f70YjZApwYpcDY2Tl6dEeRr3fx7JmnY=,tag:BxDvPuQ3GlNH3mrqvD6zXw==,type:str]
        key: ""
    discovery:
        enabled: true
        registries:
            kubernetes:
                disabled: false
            service:
                disabled: false
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1j3hsfptdfsfwvkf504etjkrtmajny9csrfh5s24uqh6fchmg5dgqg087ek
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBLT0R1M3ZUSktmQjBPS05j
            OTBQZ09uVHVTcVcwc3QxTEs1aTFwWW13TG5RCmpVb3JTV2paOVN2RW9NOEloaEZy
            ZHlKVnZaKzBMWEZwWVFyeGI3WnVRdjQKLS0tIFJHc0ZLVWV5S2s2aWhUYmNUUXVE
            RjB4d0hRdm9KQ3hpb1pobjlQUmkyTGsKJ98LSoPY+8wx8Tc8C2nAfoA1OHYsd6wd
            bFuZS/YloPoK2vHoOVQ7rGHk2IYhkzaqt6nYp/AkZNyzpWJAkobvbQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-09-09T02:02:00Z"
    mac: ENC[AES256_GCM,data:ioIvb+rMVsR86Z3Ayc9VLFBnzPBaltEXpg8b+hQ4PyVbj4nwzrS9uCrQj/moDgnmpKYm1w1w9GCxsAWeB7N1LFAKGqyJYdtStOynUVEHq6TTSGikzujsreVNmJc9sziv5+MSC5baHMC7SnllRT9cyRMAofPTxhiuyB84+duqNf0=,iv:jWRi+9xvHrSwnuA6BGle49PrfMP9HkwwbFvVFMKbDWU=,tag:SaCgcUS5dFT7wB0tVTA1yA==,type:str]
    pgp: []
    encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
    version: 3.8.1
