version: v1alpha1
debug: false
persist: true
machine:
    type: worker
    token: ENC[AES256_GCM,data:GY9YKOMSjOp0r2uTXOuhY1JuzEfHSfo=,iv:5xwiSRa4mwbCzjzOAT7T8p3g2bavd/VUjCAKSmv7LmQ=,tag:JL6PaSJkOFGIWNZBvQQo6A==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:eLFo6TQb+ZGb+H6j1VWXDc02EVXpYKmX+F4kTphewpatiMFjiIGmRHva7fQ2ihEJ11stKiaQpLRjDIq10tNJS+6QCzp9ayMJh6EhfaG1B0OExQMQ8IZnA/wseh4eNJOWF/r4yMgqnn4FzFy8oBFS4PBGK2GkvmhJ/Of7vMk4Vzu99FPV6TeNKSF1H1ske2GCvwG1g8C5O7aaC6SsMGtEGnxS9wc1csb/3y1s6R5j3g8gyZGvUvALq+NutD08+2CP3X1G1gDNXV83vlaw+1nJyqPmbJxii9cjVGckHyUuHBAvG1G3wYUPPTljcBzUmGJGi1lWb2zG+dpImmv5EsnmdOw+8Iy7tCl5o0zKlkT4wfT0czXNfQJHMkYxam+cXId4TeDNcEbwWf66yPbs5qyX3rQG4DE4gPsxI9ifjPE3C6v69Eo0m2mL3CF93gAgAldH4buf8Hhbg55r/bGc0lWG6ryjHP4pApDoCphawiTG0AYaYtORrHvbIqUTZRZ53K4le9t6mQ341IXjIhEd+a7hDkxcSC5NaRQV4TtfH9Umooovk+KE8c0m5DxB/0FEmLrkGMleEo2okhzXqx1voly/yS5hml0OKVmRxNIS/kjIK1HLsme0276T/JvZJElm6H1I+hfn5rZih3s4eX0iwMQEN+Jizic1/NT0ssYrUVHxhG8RcDH+h5S10ksqbsPMEJwf0nUewbPc4J6ap449SkyOboED4rBv0cLe6kOcKiPdaNpmlFTGh4dZ6OAB2c1byt1jcZMshlrCz5RkuXnpsCs5MKVdMDLz+vkxwESksRtx727OF4CxFA4trPiiBPxqK2JMR4TDp95C40ZmWoovrZMl47ganFKIaV9Wx41HTzFMR/nOFYus,iv:IALRRysy7C9uC4P99cEtdWvgmCb0Qckose4K+UfgK+0=,tag:5q6zXR+8S2LsYwyouNfRsg==,type:str]
        key: ""
    certSANs:
        - 172.16.11.20
        - 127.0.0.1
    kubelet:
        image: ghcr.io/siderolabs/kubelet:v1.30.3
        extraArgs:
            rotate-server-certificates: "true"
        defaultRuntimeSeccompProfileEnabled: true
        nodeIP:
            validSubnets:
                - 172.16.11.0/24
        disableManifestsDirectory: true
    network:
        hostname: p-tlx-k8s-w2.monosense.io
        interfaces:
            - interface: eth0
              ignore: true
            - interface: bond0
              bond:
                interfaces: []
                deviceSelectors:
                    - hardwareAddr: 8c:dc:d4:a8:42:dc
                    - hardwareAddr: 8c:dc:d4:a8:42:dd
                mode: active-backup
                miimon: 100
              vlans:
                - addresses:
                    - 172.16.13.8/24
                  routes: []
                  dhcp: false
                  vlanId: 1613
                  mtu: 1500
                - addresses:
                    - 172.16.14.8/24
                  routes: []
                  dhcp: false
                  vlanId: 1614
                  mtu: 1500
              mtu: 9000
              dhcp: true
        nameservers:
            - 172.16.11.9
            - 172.16.11.11
        extraHostEntries:
            - ip: 172.16.11.20
              aliases:
                - k8s.monosense.io
                - main.monosense.io
        disableSearchDomain: true
    install:
        disk: /dev/sda
        extraKernelArgs:
            - net.ifnames=0
            - mitigations=off
            - module_blacklist=e1000e
            - talos.logging.kernel=udp://vector.monosense.io:6001/
        image: factory.talos.dev/installer/43b764902da02dc235cdb9bd53b143114b6d7f0aed6d9e4dec656ea7c8de94c2:v1.7.6
        wipe: false
    files:
        - content: |-
            [plugins]
              [plugins."io.containerd.grpc.v1.cri"]
                enable_unprivileged_ports = true
                enable_unprivileged_icmp = true
              [plugins."io.containerd.grpc.v1.cri".containerd]
                discard_unpacked_layers = false
              [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
                discard_unpacked_layers = false
          permissions: 0
          path: /etc/cri/conf.d/20-customization.part
          op: create
        - content: |-
            [ NFSMount_Global_Options ]
            nfsvers=4.2
            hard=True
            noatime=True
            nodiratime=True
            rsize=131072
            wsize=131072
            nconnect=8
          permissions: 420
          path: /etc/nfsmount.conf
          op: overwrite
    time:
        disabled: false
        servers:
            - 172.16.11.254
            - 172.16.11.9
            - 172.16.11.11
    sysctls:
        fs.inotify.max_user_instances: "8192"
        fs.inotify.max_user_watches: "1048576"
        kernel.randomize_va_space: "0"
        net.core.netdev_max_backlog: "30000"
        net.core.rmem_max: "67108864"
        net.core.wmem_max: "67108864"
        net.ipv4.tcp_rmem: 4096 87380 33554432
        net.ipv4.tcp_tw_reuse: "1"
        net.ipv4.tcp_window_scaling: "1"
        net.ipv4.tcp_wmem: 4096 65536 33554432
    features:
        rbac: true
        stableHostname: true
        apidCheckExtKeyUsage: true
        diskQuotaSupport: true
        kubePrism:
            enabled: true
            port: 7445
        hostDNS:
            enabled: true
            forwardKubeDNSToHost: false
            resolveMemberNames: true
    logging:
        destinations:
            - endpoint: udp://vector.monosense.io:6002
              format: json_lines
    nodeLabels:
        topology.kubernetes.io/region: main
        topology.kubernetes.io/zone: w
cluster:
    id: ENC[AES256_GCM,data:gCnCUiBIgwgwX7K/474jGg8G2PvU6U9NJMwD92orAveeWKFs825XIeFsDW4=,iv:NAuEI0A0fsRyos20folk40vOtfwlwFKH/8Uy8/2Boec=,tag:xjS8CF/KLRQgLyAl7mWpPw==,type:str]
    secret: ENC[AES256_GCM,data:39PydUgt0lzQhPuuLNHA/4cf4jyfXKvdau5O82iS6VCnoHJsawJWoNLQHtQ=,iv:xXdim/hTTKzmGlHProEqTdmCx0KXbtZOVbKGMiEWfks=,tag:3I2SyI6/pSEu6AikpybYDw==,type:str]
    controlPlane:
        endpoint: https://k8s.monosense.io:6443
    network:
        cni:
            name: none
        dnsDomain: cluster.local
        podSubnets:
            - 10.42.0.0/16
        serviceSubnets:
            - 10.43.0.0/16
    token: ENC[AES256_GCM,data:ABj5RlDRm5o/24SKLRNfuUhCF/pqzGU=,iv:MFl4bZYXyTALWnKdNTemuzh5xIMQoADic+Z+4uMSm08=,tag:LKtZR0OnC883TQpMNEliSA==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:COlL5Y0rc5MtbRyMqA07hhhHd95oivTDBfFs0E7QXB6gP3xXQ70PA7RQkeViBLzaEkCQvaXwmj+uvsAwk5E0bADkiAyc0ZRXfEKneqFuC7oxw4xAgNrkTQuqPd5SKV5Pv1pbrtg/jV39Thk3om+bthUqVhQBpWg7mQ7jpL08TZbjTsq652VGp3k0a1EzLEDY4AXMj4mPu5gQ8SYAW+BifRU65CSnVeip81f/1/e2CgSHvqXNhyhfl5hkkT6HhmzhV3JjShmHRm7wGQ0wqzWz9xh4yfqJat+YQNr+BJG7RBZ7wl+6Grth3QSJw2DZcIY3WGjV6tY/W0bXQiVNHeiVxWStI77Vxtm1ZfNQC4PDwooucqxIVncGOMckSoG/p3/QhTU295PWbXYpGHwOTtIbapyqXPFLjOIB4BJ4IEQS759WBvmtILWwj4nePEZSAzBpL7fvk3ypbP0GRAWhCgPfH3vL+wUD5yVgTis/5y3cbmd8V0PdZg1r2+PTPdpsjryeywp+IOY5ZcHJZgKKo87JdoTViy/4cB9XdOrWL1X+FP2S24a2r3q30SSR1Jj/uM1M8zqyodEXCKk5hbzFNDrgB8tSxjn0gpm2Rz6zRXi4LakPBNiKtj3OYxl7uSxDI2GZ4ePVW4tyA2N9ngKlRQ3nZLRV688/HgEL72WcvhTT6M8rq3Ey69pfJlwLDYpjxDq4YlbNCQMOdCfhjUMCrwLh+GUdZjMmUivMuPi4FPubLUmvOPmLsKr5mV9woIHshHt9F6dykdGPWSusENcI2UsJ/THn7YOk99bG5CgxC0qdcYft0fcSnTiprKg2y9IRqEGb21fqGvAZY1a03+WFjvhryQygpEiSzg1vFsBICgJLYFqCzMaF6slBG5ySxlf/6lSeRrPd96zn2ObjvZMPZHyaHbBOuzP9C29o6FzcRcbZWiLr+FuZsYti3w6/IHRo1REa6F3+V2tlW/JvIQolqkj1yuqJr56dp9L5PRr/wypV9J13GBaRNdAPTmQJt2BiS1RejRYOaojRbkkcOA0Q43/5RiPjQ5/HAeT1VOgbvQ==,iv:H6myApmYStk9fk4zuC1TaMxDwDOtB+tNIyx+PT/jmZw=,tag:QskgcMF85AU8Mp766rdH1w==,type:str]
        key: ""
    discovery:
        enabled: true
        registries:
            kubernetes:
                disabled: false
            service:
                disabled: false
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1j3hsfptdfsfwvkf504etjkrtmajny9csrfh5s24uqh6fchmg5dgqg087ek
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBHZjM1ckwraWZCcWFBcDNp
            djF2Y2Y4ci8weHlISjVta2plVlR1T1dRQkVNCndWZHU3elMrYmk2SzgybVoyMVZ0
            dUVpVmNzaDh1aWx0MXhJd1lOS0dzTmcKLS0tIGZmQnZuN05CdWJ6YUlpT1V1a2Qr
            bklJZGs2Wno2ZHpkVk1neHdEYzJkdGMKIxycr91c/Uwpd/rTf+0VyY80Na+UBeL4
            nKZ0JZg68BB19/UD2stuGrMRQGytoBLwglbhQk+x1gbAYmCWu4rcfA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-09-08T03:00:00Z"
    mac: ENC[AES256_GCM,data:fGSZTvxCjhI6ftuDgsF7IVpwKm0AMFyqQlajEGgFeFb9qcc8IsjfBSeEaYUZkBXRTcX4JiTOfH5J1+8uWptuwX38Pb+sysNWnl2HGu9BPLjGZ7VGXgNFGllMl9cxot5MMI0wLHq9Evv2i0j6LM+UmNsvURipy+ZrA1/H5L7Sm5E=,iv:vVcM5FmXNtfsoq/fzqHemlFzttm7Zcv2aPD+QwT8AaI=,tag:SrOU4RHBxdq/Sj8zdggdkg==,type:str]
    pgp: []
    encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
    version: 3.8.1
