version: v1alpha1
debug: false
persist: true
machine:
  type: worker
  token: ENC[AES256_GCM,data:U7bGo4wo5QPBa+41/oeMSqlnJw2cpP0=,iv:iQccVxGbnyKkbc3nmhIkC4SRFYrVi0qSnUrMVZBlyek=,tag:7g82oPVnOVTjw0X0BUyz7A==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:GiRqf4OUMILFB6LUIndzTdMdwFDGHDbkr9EOO+lv44zzjBG1iLwuHBsg8txqx34acquB2f7sznLcerY1OQzk5p0kE0v8b/iewov+KVqZRiDcJbw+W0ZT+2+Pxl11BOV3Qhx5GLazDKAlDNcAZbJedM+7ePAh9GY02qtfGC6jQLDAmNinVc1mXGXxTwiOBJC5c+w30SmK4m+0gw/luM5YfT4HUi9/+Gc+9TUDUn7nJvrQ9le558uJe2PdNqI3Xt8rDC28VY/cY+XufDEZnTS1aM7CTOi1x6aER5MUkFX+zjYn/WV90ya7KJTzQNTzXoXQTvKsofFfqu3zqAvPdCkPiFYEqyNaf0uFawpxi3lfpnWtsrUW9BrkgERTuK9rWJtCuCxNb6y675GIcNic1H8Vvm76cldt9H/tx4C13Z0wCryfMKf+IJU+sVCNZU1rAkTRrPK3wmeT6vOag2eSsoYJHBvfXt/xshBHMBQ+6kVKxvIAw01px4b1miSm0qd+CUGSuganT1A5VhMd4WhkKrrdtnjhIeraz1u4CaH4RJ8KZAEE9f4MEZwPpaQYWyZcUoLg7qmMb9osL+ILkpIpqjgeYfoIHvS5Hkvqy21erDT+xXCy8GZovKBHJI95oiNKfNnSFf6G3R+EvxWxLYQeWiKf8u8epjUjr3lvdbOgUBpOHsy8foX8LGT2z9LfI3zCb3zoHrj/63Mwq3Xrv93Ok47r0pWOg70Uc4bbr+BzUWhqIelpyy/hoYDxX8BAvDqRXlfGZ/y9sac+S8wIC5luxbLjhqMEDks2NiAmAObbLQy3UGjYkAAi5PAsND4oVfCRJ8O5UGQ88SGaLKPFWmqZPPfMHA66tIH9D8sJYxbeoMRwKnz5RZND,iv:ciXmYYo7WVQRlVbJjZME0yxONjwokdxyxLRF8LTlz74=,tag:lgTp+N/jhMhFrOuH5/pFlQ==,type:str]
    key: ""
  certSANs:
    - 172.16.11.10
    - 127.0.0.1
  kubelet:
    image: ghcr.io/siderolabs/kubelet:${KUBERNETES_VERSION}
    extraArgs:
      rotate-server-certificates: "true"
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 172.16.11.0/24
    disableManifestsDirectory: true
  network:
    hostname: p-tlx-k8s-w0.monosense.io
    interfaces:
      - interface: eno1
        ignore: true
      - interface: enp1s0
        mtu: 9000
        dhcp: false
      - interface: enp1s0d1
        mtu: 9000
        dhcp: false
      - interface: bond0
        addresses:
          - 172.16.11.14/24
        routes:
          - network: 0.0.0.0/0
            gateway: 172.16.11.254
        bond:
          interfaces:
            - enp1s0
            - enp1s0d1
          mode: active-backup
          miimon: 100
          updelay: 100
          downdelay: 100
        vlans:
          - addresses:
              - 172.16.13.14/24
            routes: []
            dhcp: false
            vlanId: 1613
            mtu: 1500
          - addresses:
              - 172.16.14.14/24
            routes: []
            dhcp: false
            vlanId: 1614
            mtu: 1500
          - addresses:
              - 172.16.15.14/24
            routes: []
            dhcp: false
            vlanId: 1615
            mtu: 9000
        mtu: 9000
        dhcp: false
    nameservers:
      - 172.16.11.9
      - 172.16.11.102
    extraHostEntries:
      - ip: 172.16.11.10
        aliases:
          - k8s.monosense.io
          - main.monosense.io
    disableSearchDomain: true
  install:
    disk: /dev/sda
    extraKernelArgs:
      - mitigations=off
      - module_blacklist=e1000e
      - talos.logging.kernel=udp://vector.monosense.io:6001/
    image: factory.talos.dev/installer/${TALOS_SCHEMATIC_ID}:${TALOS_VERSION}
    wipe: false
  files:
    - content: |-
        [plugins]
          [plugins."io.containerd.grpc.v1.cri"]
            enable_unprivileged_ports = true
            enable_unprivileged_icmp = true
          [plugins."io.containerd.grpc.v1.cri".containerd]
            discard_unpacked_layers = false
          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
            discard_unpacked_layers = false
      permissions: 0
      path: /etc/cri/conf.d/20-customization.part
      op: create
    - content: |-
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        noatime=True
        nodiratime=True
        rsize=131072
        wsize=131072
        nconnect=8
      permissions: 420
      path: /etc/nfsmount.conf
      op: overwrite
  time:
    disabled: false
    servers:
      - 172.16.11.254
      - 172.16.11.2
      - 172.16.11.9
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    kernel.randomize_va_space: "0"
    net.core.netdev_max_backlog: "30000"
    net.core.rmem_max: "67108864"
    net.core.wmem_max: "67108864"
    net.ipv4.tcp_rmem: 4096 87380 33554432
    net.ipv4.tcp_tw_reuse: "1"
    net.ipv4.tcp_window_scaling: "1"
    net.ipv4.tcp_wmem: 4096 65536 33554432
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      forwardKubeDNSToHost: false
      resolveMemberNames: true
  logging:
    destinations:
      - endpoint: udp://vector.monosense.io:6002
        format: json_lines
  nodeLabels:
    factory.talos.dev/schematic-prefix: 03f8321e7acabf80dddbde44cb693f3c
    factory.talos.dev/schematic-suffix: d7b4d4a571bab9ae5cb74be79872a6e9
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: w
cluster:
  id: ENC[AES256_GCM,data:Ju3+kjJhADK/DD0xsVRYnxEopZaq2XeBGd2bEDyF674PrjPoq4XU3f9hvPw=,iv:U7dizuuPSSo7eimm9fKLBTouoiZkwZw6p+UQ7nixwoA=,tag:QnGAvTwvm04jb000oXPjWw==,type:str]
  secret: ENC[AES256_GCM,data:2mFEMNZVqAAVH8BtHf7hfjTUoVfsYyHmzUWYNOcSMI2mw80x9Pr7cL9Y9LM=,iv:0GHRqwhxg5McWfUEgK0hBAiWEsZM36fGZZmmpKONcRE=,tag:NylYihTKn7VNvJuTUxHjoA==,type:str]
  controlPlane:
    endpoint: https://k8s.monosense.io:6443
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  token: ENC[AES256_GCM,data:IV2Kzh3QWjiLpvH9XSaz+rDpa8ZTRSU=,iv:2eKGA1ZUfEdAvVWVJC3E55kPglE6GYi12X5k+PJ+Agk=,tag:QqKWGaLdahlFU+F/HDSQ1w==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:MT3P/B+cfeWE23AppC+lJxKcQsh++DxVI6TzB+qdLHe6PAlOkYXAouFAVGirbBCneQ+6/ZgdliKshHJ9hZai5P3c3hChoaBMPTJh6sK2uSHX9SQICYuVH9aU1ixfN3BUR17xvY8xCkiFZCjPCNhsunnBL58kLak+q6d47Ph+2Cq+62hJVcJ8mxLNY7y6spQuTH+lG77VkKnnhnlebgy1CZjN/SrKOEUzSb9DA9CYta0G3gR5chqQYguHHcZcYkNWIZBvD1ie6noM+F/AgtIkp4nwEM6ADm6YoTrfkkBLm6nWIfsCq9L3cHh1B2yz797Hki9NY5NC3J44MHcYcMa1qM69oYFpyPbgTEs3s6+juMNcXo0e2afMbRNxve1FxsDsJzEHa5izuVf3PUXxPJDd6/3/4WLqFA+ZiQ4356v6vCkFmbGcYcrG4HecspkdpYN6MAszmx25k/92T5yUHo8OpHwHG06ThqXRREBevzVb69SXGdn6VZ4zkiP33+P51DFmpxNtTUcV4V0R7WkVt669ZVxqzWqIOmFxcE8G/lCENn/2AmIqXsTqCHxOJtA6RRJ2QxJHS5AxMsGxRO3UEYxu2RyL5WFowl0yeHksfizCqapHFaDebeCpavATJ9Kl6O+d37+P8s8ExqRQpdt2qzfDlNruCvqfXHZHl5vZXQiwcZkdtsaXf+eIfO8LYrP4M0Su6toeouvnv6DgMgSkO7fsYNAAYLOA6+j62qOEszYZ67CNkp3HWk0uVCr0yO9mhx4/fIcKuHB/EdwckIi9Z3XZmIQgOyO6FlDPV7a+q80PLyzq9XFWAn6akWtD/HFr7vQSbbMuTj9bszF0c8QWjbbguNhw8BFLa5A9cUdXwh2OHPcrpfg8lCnBEau0fGZ9CSjbVNUNiEY4VZaF+k6EdSfcjLBLA2evW9oUbYzvYYqQb1/u+XkbXzT+fQ6+wAtUGRLRZGln9+DBX09yKhIK0nkjz9t/UuD1P8dzpA1XOHJTZkPPimcwW1j99n/jXWWaLOcN53jl0CR63iMjr6jbSvNguZyIrwOqi+V7vkrl4A==,iv:2cklzSTrq8f1fKuGYtrVpgVmq3muOOdGcvrork0oExQ=,tag:Z6BE4K57lfHR3ly0ttBtiQ==,type:str]
    key: ""
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: false
      service:
        disabled: false
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age1j3hsfptdfsfwvkf504etjkrtmajny9csrfh5s24uqh6fchmg5dgqg087ek
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSAvbTZ4OXhBdEw5TjErMSt1
        b1lEekwvUkNsNTVCT0hmRStuM1p4bm5hN2tBCktwWHZFN05lWTdLdW1MOFZVL0RX
        dGZiUVVkL01BQ2tYcUd1bHdQVlpPT28KLS0tICtpMTN1RjdJWm5CcXQ3NFdDVDlq
        SWhQQU1kbW1qaFdKRXA1Um1xQVo1WHMK5FI4/XgOM632O3TS4HFksR5i2SM64N2f
        sCh39tjzj3KU8pwslrhEzmjt5Csm9SN/aPAQomBtzriVrUwutyugyw==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2024-09-17T01:37:14Z"
  mac: ENC[AES256_GCM,data:8bOIU6rHaER0Q5XQwWzE0IGlTyuL7fXOmXX2jd6GEq0j31XRvXnjIN0jTcEFWok1gXFnZ4wW2t0POx4difmL6Icfc9YQ9tzSGZdSzyCY+4TN6CY86FF0d3d7GPJhuaHdpM7f3RwX3GPLpc80JhWOjvmKTMokaP+lVChn39taWo4=,iv:PbXZ7ITb2xnegBTEINfFKwz/CirjAMnzN2cXyMXhbmk=,tag:2VNIAeh32hOZUArcL5wz3Q==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  version: 3.9.0
