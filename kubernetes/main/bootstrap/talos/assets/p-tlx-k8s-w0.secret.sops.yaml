version: v1alpha1
debug: false
persist: true
machine:
    type: worker
    token: ENC[AES256_GCM,data:ZibI4xkApFpopc0gRkpdMzCPuXZZS3c=,iv:vfAND1vIA1hnSDKVDf6M1zZjAwfb/HWiQ0yCcqnHcwk=,tag:sSnwAPxN4jmLG0TocjWwNQ==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:5Vs+ouB6CD10DUYtlJC7tlZIs671rFa3lBpNpR2W9THVBghCj5YEwD+PIeA4VK8HGz8S8+FM44Hrh1sC9feQHF4AAWFj9bPLrUNG0RoimXhSj0rSCTICBlzc9FkhGewTTKnZ8ZYAXeep7DDoSXY2EXk2l1D3pVI9NtPkxbjF6WdIoXo5hZSfLJchKzqU7nHvyIScLh4xn0RbYq1qjNI6v8/XswKwdkB9kvWyYmCh9gn6BfnkY9kXTLtgdWCNjXQ0tv2Glf6Fh2pUHjINpoXh9Edryhms7krAirddPoSzGmbLSMYHfKMV3KDRd9cj1KTgZ0lyXbjKiGBVW13pBYOl/zd0joeIbO4fwNIBHZA3GbV5kaClGKu4f+hbVU1oaobe87bf+Fvm/CarHdSKOTddbUWi07Icnz2Nup+fNStdiK59fG1pc9r4bmNGyCAR19QyJK3IrEBY3m/ohOf03Jaq2H4NKnP03qN8XseVuCjskTRv39vrQC3IgIW9Tfil06rPkkjm93vs/CrcK4Nl1E7jJV2sS51YWjJGiBZjBNt/JOz+o5av3x0gwG38+BYdcuaxCkHatJh/Ly5RfsccbzLkiTGImugZk7+S+uViZalM51+HBlVu9fk5M2+G+dpzpjIXa5yzS/SwAhWCViXky3BwQb80HUMpXH0GOGuziKvtx+kM1LE9NBky9/9YQuB23B22Nh1pGTvwu91bV3DLrWC1Ej+p2Mgp7TNPnCuvW01LCrX5ii/N0z6ZHcUrV5CM18PA7MEKZifhuaMVKUG8kAQjpWaATKHIdU8dy1HC3+JwWrvRddXIRs9XO/WkKHRCPFjP9rL5qj8EY5cGi/gtRncJDUoa5HZDH4MvaTBEzvSNhL+veISu,iv:jmvtCUveH/Usv6WZA0YU5PvE9H98NlnacONQaNfQsRo=,tag:CRzEV4Gk8t9k9pslyWQGpQ==,type:str]
        key: ""
    certSANs:
        - 172.16.11.20
        - 127.0.0.1
    kubelet:
        image: ghcr.io/siderolabs/kubelet:v1.30.3
        extraArgs:
            rotate-server-certificates: "true"
        defaultRuntimeSeccompProfileEnabled: true
        nodeIP:
            validSubnets:
                - 172.16.11.0/24
        disableManifestsDirectory: true
    network:
        hostname: p-tlx-k8s-w0.monosense.io
        interfaces:
            - interface: eth0
              ignore: true
            - interface: bond0
              bond:
                interfaces: []
                deviceSelectors:
                    - hardwareAddr: 7c:fe:90:a2:c5:90
                    - hardwareAddr: 7c:fe:90:a2:c5:91
                mode: active-backup
                miimon: 100
              vlans:
                - addresses:
                    - 172.16.13.6/24
                  routes: []
                  dhcp: false
                  vlanId: 1613
                  mtu: 1500
                - addresses:
                    - 172.16.14.6/24
                  routes: []
                  dhcp: false
                  vlanId: 1614
                  mtu: 1500
              mtu: 9000
              dhcp: true
        nameservers:
            - 172.16.11.9
            - 172.16.11.11
        extraHostEntries:
            - ip: 172.16.11.20
              aliases:
                - k8s.monosense.io
                - main.monosense.io
        disableSearchDomain: true
    install:
        disk: /dev/sda
        extraKernelArgs:
            - net.ifnames=0
            - mitigations=off
            - module_blacklist=e1000e
            - talos.logging.kernel=udp://vector.monosense.io:6001/
        image: factory.talos.dev/installer/43b764902da02dc235cdb9bd53b143114b6d7f0aed6d9e4dec656ea7c8de94c2:v1.7.6
        wipe: false
    files:
        - content: |-
            [plugins]
              [plugins."io.containerd.grpc.v1.cri"]
                enable_unprivileged_ports = true
                enable_unprivileged_icmp = true
              [plugins."io.containerd.grpc.v1.cri".containerd]
                discard_unpacked_layers = false
              [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
                discard_unpacked_layers = false
          permissions: 0
          path: /etc/cri/conf.d/20-customization.part
          op: create
        - content: |-
            [ NFSMount_Global_Options ]
            nfsvers=4.2
            hard=True
            noatime=True
            nodiratime=True
            rsize=131072
            wsize=131072
            nconnect=8
          permissions: 420
          path: /etc/nfsmount.conf
          op: overwrite
    time:
        disabled: false
        servers:
            - 172.16.11.254
            - 172.16.11.9
            - 172.16.11.11
    sysctls:
        fs.inotify.max_user_instances: "8192"
        fs.inotify.max_user_watches: "1048576"
        kernel.randomize_va_space: "0"
        net.core.netdev_max_backlog: "30000"
        net.core.rmem_max: "67108864"
        net.core.wmem_max: "67108864"
        net.ipv4.tcp_rmem: 4096 87380 33554432
        net.ipv4.tcp_tw_reuse: "1"
        net.ipv4.tcp_window_scaling: "1"
        net.ipv4.tcp_wmem: 4096 65536 33554432
    features:
        rbac: true
        stableHostname: true
        apidCheckExtKeyUsage: true
        diskQuotaSupport: true
        kubePrism:
            enabled: true
            port: 7445
        hostDNS:
            enabled: true
            forwardKubeDNSToHost: false
            resolveMemberNames: true
    logging:
        destinations:
            - endpoint: udp://vector.monosense.io:6002
              format: json_lines
    nodeLabels:
        topology.kubernetes.io/region: main
        topology.kubernetes.io/zone: w
cluster:
    id: ENC[AES256_GCM,data:KUyZPm+a9GhD+1WWDekoLzuc+MNv4fswOcpihHBH4cliFnNEoWaBBI8ws5s=,iv:eAKoxTsXdKHSLdq67qPRoftOCYzxmLkiEMBfDkC6rbg=,tag:0ygFMICviEzAgTHSV/P1jg==,type:str]
    secret: ENC[AES256_GCM,data:RlcHOEAb7TM24gMPynTnlcUGB+K1NaUKDqtua2AwUc0sPZutiWnhE9Hu8bI=,iv:QKYr+G9lgmleIAny7KeWK777UYdGSyhnnIgmUj9+6CQ=,tag:jhiw7rGT0gMrcO1t18RrJA==,type:str]
    controlPlane:
        endpoint: https://k8s.monosense.io:6443
    network:
        cni:
            name: none
        dnsDomain: cluster.local
        podSubnets:
            - 10.42.0.0/16
        serviceSubnets:
            - 10.43.0.0/16
    token: ENC[AES256_GCM,data:O6rn3p50+8hrkQ4u4Ml/cVhX0wz61mo=,iv:tsmOPbcHBfn2H+iiRisSYKkrDN3pB0rXkncVDpSaJ7E=,tag:BdC8/VA5x9hdiReq/CWU6A==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:hVTORFP9fIo8Hou0QsgkcJucJw3aWoLeuAzBIUHmoxF8Y8Ka35imWgjPUmsy7mVVlfyHX748x6IsgjgO77j6ZEtmybjkQZbVniVa94Uxk+Cf9XwRgsRv1UqwHw45YkUEimrwhQZWBGj4aB/6YTtsHZySlJcyEqFsyg9NmXLeReGefNd5C57osR0bEb8lwqfNdA1FKfN77s6fe8ss94E18n2KndtU5D4pbXiqHW0kuyVW3jt7+mQNxExQ7NH+C0Ay3KtGwuWrcjuXMpLKK4v82E97SJNn747PaAIUNN1g4XzjvQHHczcsGJvJJ+VrcUgjNXBnf9Ki5nDvnVXcA6o1EDXB9qetR/uEkbVAAw1KnkbBK0Zx4xB3CrsDbWoUW7kvXcnLoU5w2Tea39v87LSvcAZF7E84FQH0BSmL86FY38OnBQuYSwzOKiQ2SEVFMyCVwz5/4j0E0mUNLp2GvX9uWoAwJ85ALGpUa2R4DV/QAGb22MIu9cXxLFPgHZ2w8TrKAI2drV3Rt6m8MNhejJT8o/T6fkWsv95hmwTpX8Pd9LQqliOdU7p7bN30us4Gwmtfqwt9ezW9MUZDiSppR6c6/mOMNdZDlpggFoFy8OVwzXtOWPJmKY4BbCczSchvWPAdaUtikY6GSkP54UcXR2sLxQ5QjQLwh5TZpIzOMSnyShxrqow63x/kZrNH8VWmkUiVqzluUt3vzMF5x3ozD3EVBe1zKxPaIPrNmIi3spXXs6oU1e06eY7Pmh+SxoYSDeXd0EdQDt5oE0mI1rIQFiAdpkIfoWpYRv2hZVIgVU0NxeCOqiAoyryLsuvxJ66DSUoWMn3FdFk9Pa/b8jdim3zosrxq811rKgtEUZGMPM9ap0kB0+gPAnF2cb88ZOgsIn6Gap9AQhOBZLavfM/EgvZ14ykM1EKpTzdkDvSFsTbolJNGD8oBa3y8I9lPPDiQL7IwD93BI6mVaman7/579t+SKH/1YVR8XRyznhAKWo8EBzQUjEKtpQf+EcH15NLrHFU4BlwaYnqP13FIG3MwYpYzxHLGDzMAa12wm35j6Q==,iv:s+Ey642+2/ShmXqH5PlC132EEDIcedu7m4pS6VFHRsg=,tag:B3SJYbFWoMVbd2wiX8xAeQ==,type:str]
        key: ""
    discovery:
        enabled: true
        registries:
            kubernetes:
                disabled: false
            service:
                disabled: false
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1j3hsfptdfsfwvkf504etjkrtmajny9csrfh5s24uqh6fchmg5dgqg087ek
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSA3d1hqY1IxK0J0U1g4dUpP
            a3hvY0dzMk92OXhEalBBaW01bkI4Kzk5dEZrCmwwMWxHOFdhbjRmV0dISWtVdG00
            U0lzeTlrWDJPcWxTVnk1eTd6aDBVNzQKLS0tIElSc0xmdG1LWHFtSGMwWlBSdVdR
            K0dBRzVHUitPR24zem5RbEl4QmtnSEUKiN6XrwXSpBVhDcBo64MhSuZkyC/XfoX4
            /cDvlFLeNTg01r4k20Jx92+I1CMXtHY9JdP/xgPBy7xVkxB8VDUrvw==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-09-08T03:00:00Z"
    mac: ENC[AES256_GCM,data:cMEBDuVEiMNN+zgNK807GONEFGvx7F9K5vkVO2e/saqyO8tFgyH2f+B7lAbBWspt69JYDowV49xItRYAnlCYJP8QgcGSTnw2UiqTPvq1k5hi+18wDnNmUPII+fiaxWK5kvn5LpYrncjbBOj+tn69HMjwD0oQXtO3P33L47PHZaw=,iv:bgvfGxCfgAId49J9rJxWFeQjJMEbuGsGpETAZT0skeQ=,tag:EPA7HzIArhnKFGmTN1FucA==,type:str]
    pgp: []
    encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
    version: 3.8.1
