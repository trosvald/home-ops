version: v1alpha1
debug: false
persist: true
machine:
    type: worker
    token: ENC[AES256_GCM,data:u2p/Mv6VZBWk/fIb8Fu6fB9k4PlTGOE=,iv:+u4Bjx6qLlTb4TfKSK8FORsH5ZGOp+BVPTvYwWlXRJM=,tag:6X7xz4F13Pm3ZZ1YZ/NrJg==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:plhFHUJk0wvurU8O7fWZ958jfYPvMAJ4+B+B8+f/TT9zx73Bp3rupkr8tdye1RmyGpt+/Vdz3T513A1NObNjwFQKW+Hww1XWGE0j53xn/JUizOF+CWBsBwbf3I25peLzBwApXj7Kdf+cs4cBQyqK6v4m0EZmAXvqDrcuvqgVLxwXtWMzkrClIXBorej9iIw8oYHsCdeUD/Ol5Gjq3E8G6fZCMTVNAMzIA9MHhTpQlyY54Ym3cHtKEXgIPjdQa5eg32ywBntDE9YVzTUN2w3NH3wY0nTtOKgp+iUzzdgW7rj2r3bkwhYkuzGdCi4RK4wwKDNqWNZX/6x7UsccVqOo4bHgCJOBAgEPwZuRJDKJz9zXB1RQvGKaLQZJutm/p9tUWpGxZIE4nVDHcasXM1CCJer8YKr3MIw1wn/LVPmf+kh1o3BbTuC/DNd4fhQwlKcvHy6ajAUT6QeYIEenu3y5Csh95xQRsbxCinXenWqUvLtAK4fu0RZkrF2Ml5cdADB2xcevoYE0tFCjF/teEEgkSIDSTpMt4i2AhwTQPckz9NXyarhwvl/NLsll15t2x1mcIMJ9dqt+g2IKYKnmTei7WU5qYGw3qn2BvI1HH94Z7L9agR3EUyo/EDQOFHjvNauSK3sIatoF3YBnRCRNvtz/TTwObdjKvhZGE1HCDHDMrqsy8SzCLkAN8GxlrKaZI0k5tRIChrDZSyjecsdtKnH9hCMJjIJotruprpMEsdZAAl42aXL3D5tOUUUpEzpyaOXQJC6GF13kKSn5NU+C/FclwehrzxJtW+VYd4Ggca5dLxKsf24QmgUb47UuOa3914D15RKhUHtT4/31V5dRb+fNuCJDzuthLfQkiWX7BpuiZjIsnk76,iv:S5EEDPm3QKLoDfZwe20v2r1glPi3aLlN2C45VR6t4Oo=,tag:j34BG8KT1oVbqONwZwlRCQ==,type:str]
        key: ""
    certSANs:
        - 172.16.11.20
        - 127.0.0.1
    kubelet:
        image: ghcr.io/siderolabs/kubelet:v1.30.3
        extraArgs:
            rotate-server-certificates: "true"
        defaultRuntimeSeccompProfileEnabled: true
        nodeIP:
            validSubnets:
                - 172.16.11.0/24
        disableManifestsDirectory: true
    network:
        hostname: p-tlx-k8s-w0.monosense.io
        interfaces:
            - interface: eth0
              ignore: true
            - interface: eth2
              ignore: true
            - interface: eth1
              addresses:
                - 172.16.11.6/24
              routes:
                - network: 0.0.0.0/0
                  gateway: 172.16.11.254
              vlans:
                - routes: []
                  dhcp: false
                  vlanId: 1613
                  mtu: 1500
                - routes: []
                  dhcp: false
                  vlanId: 1614
                  mtu: 1500
              mtu: 9000
              dhcp: false
        nameservers:
            - 172.16.11.9
            - 172.16.11.11
        extraHostEntries:
            - ip: 172.16.11.20
              aliases:
                - k8s.monosense.io
                - main.monosense.io
        disableSearchDomain: true
    install:
        disk: /dev/sda
        extraKernelArgs:
            - net.ifnames=0
            - mitigations=off
            - module_blacklist=e1000e
            - talos.logging.kernel=udp://vector.monosense.io:6001/
        image: factory.talos.dev/installer/43b764902da02dc235cdb9bd53b143114b6d7f0aed6d9e4dec656ea7c8de94c2:v1.7.6
        wipe: false
    files:
        - content: |-
            [plugins]
              [plugins."io.containerd.grpc.v1.cri"]
                enable_unprivileged_ports = true
                enable_unprivileged_icmp = true
              [plugins."io.containerd.grpc.v1.cri".containerd]
                discard_unpacked_layers = false
              [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
                discard_unpacked_layers = false
          permissions: 0
          path: /etc/cri/conf.d/20-customization.part
          op: create
        - content: |-
            [ NFSMount_Global_Options ]
            nfsvers=4.2
            hard=True
            noatime=True
            nodiratime=True
            rsize=131072
            wsize=131072
            nconnect=8
          permissions: 420
          path: /etc/nfsmount.conf
          op: overwrite
    time:
        disabled: false
        servers:
            - 172.16.11.254
            - 172.16.11.9
            - 172.16.11.11
    sysctls:
        fs.inotify.max_user_instances: "8192"
        fs.inotify.max_user_watches: "1048576"
        kernel.randomize_va_space: "0"
        net.core.netdev_max_backlog: "30000"
        net.core.rmem_max: "67108864"
        net.core.wmem_max: "67108864"
        net.ipv4.tcp_rmem: 4096 87380 33554432
        net.ipv4.tcp_tw_reuse: "1"
        net.ipv4.tcp_window_scaling: "1"
        net.ipv4.tcp_wmem: 4096 65536 33554432
    features:
        rbac: true
        stableHostname: true
        apidCheckExtKeyUsage: true
        diskQuotaSupport: true
        kubePrism:
            enabled: true
            port: 7445
        hostDNS:
            enabled: true
            forwardKubeDNSToHost: false
            resolveMemberNames: true
    logging:
        destinations:
            - endpoint: udp://vector.monosense.io:6002
              format: json_lines
    nodeLabels:
        topology.kubernetes.io/region: main
        topology.kubernetes.io/zone: w
cluster:
    id: ENC[AES256_GCM,data:48Q0VfWGE1yoYjdayCOptyTwfubwkzTFzkMy7KLfUzqzDUJhlwsdTKapcII=,iv:4IizaZqJIbzY8uoz9xvmzD4VkMTXNdyuUOXVDs4/Dco=,tag:96lfPgKdbIpnLmda/p3RqA==,type:str]
    secret: ENC[AES256_GCM,data:PuA/+SHHC7PFjfwQTkaCjgk+s11TRi7YnLrW2w2P6r4nklM982AaI3C8AkE=,iv:UB332WFxvk5ePk92PH5E424x+V62izilLJnbvShvXS4=,tag:hfrDFGfX5SP2/MBs8C3YuA==,type:str]
    controlPlane:
        endpoint: https://k8s.monosense.io:6443
    network:
        cni:
            name: none
        dnsDomain: cluster.local
        podSubnets:
            - 10.42.0.0/16
        serviceSubnets:
            - 10.43.0.0/16
    token: ENC[AES256_GCM,data:8SexsAHzIzRlUbw+F9CFDzg0SslE86Q=,iv:haqw3V2jBffPtmbGmp6k/dqyghUvZzZkSA9//khs7kg=,tag:bWqqchCm2Pf/xwNZlZPAcg==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:vpc7x4V04XQ3zy/8lj420xd7IkoGr5ZjfR3LlkMC9uteiUrinl1bvqJmlDP3lUQCW9CICvsoiBzURuTyLNR1YjqmI/rgKn8tkCpOp60aiivGBFnVhXeIcGDnvGG8/O+b/j/KVO9YWjqwKL9xks+ltvQoO8m83f55M+CjofgCY5ZsFVMc10KTfDMKBep/0+6BhuWTDtSS5gDCf5w0iBIEnHSQVBtCW81uVKrAH/BB2uXdVbieclSD8JeMBKpgdqK68GvHvzpeuigg2OTxoI/Cbw/fnCCm8S5GFNuU5BrQdWTcW26A2XZXJZGTSxYbA7cuF2OlUN8i+3A2Z5AeP5qBGhSePCUGzt/kaCuJqS5KqfOPgjjIQmDdJOWWpAyw2bDq7Xb553XlHWt/668yQuSHTx/NxQoMXmN2PnLDNbZ1kHKbwp0NmvySR8oDfOZer2xvndqNsnQ7Dp3IqL49M7Mq1OzC9kMg7cEUYJ58WsvaN9mdTEB8S436aKBQMaM89YmekNC1P4X3geRBIIvbFpOdoGUhXbm3rncLxylHFOfloLarTp+wJGP7Xubp2JdGmroYr0XAhuHZ0i472nOtVsZyCEHYIoplqlZuglbGhU+JpWUCImgicpyvPcQ/v/6kqURGCZmZsiNn7OyJ9FARg80mvPYS/Un+8R+HhOCJYRwjIwumEhRX1ptL7B7BMYy/ryXHtGfhpTdsAyP4o048ixpUpXNZtzzpGBwLQPykAOmXFpEPfz3RcS0sYSv/vXxSJGRhLG9TbG9vgnlxZE12y86g8xNgS54NrVhtTAQ/q33W8Yf+kzCTLlF/1TFVJnwbHd1ZTLPjy/Sfv2Y0OJ0CAGDc9qXYPhJ9sFIqv3Loj6fSUJWjEjzHHLDEBFAK8jVH3BElyi4RCWVEoOUknx1dw8F9lSyRsIUzkpAgNWfTlruEH/IRRi6xXDS2OFbeCryQ9cgQGqsAZ7sB/QXhKYETy8LZOt1E03N/sGZuAjVYsSEik0t/P5ZNTOVpKP6VPo5XtJf4oC0iCbKO/RyxD6kyka/cLs2FI6zvN2dx5zxqRA==,iv:ubEBVQDkN/8O5jumzunwmeulnHRhJIgo2lf3eX/y/mU=,tag:d9pBtNPqB02LvaSkhGrAxw==,type:str]
        key: ""
    discovery:
        enabled: true
        registries:
            kubernetes:
                disabled: false
            service:
                disabled: false
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1j3hsfptdfsfwvkf504etjkrtmajny9csrfh5s24uqh6fchmg5dgqg087ek
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBFMUxFQ1ltWjRQaUZlQlFr
            cnpmbE9CODRQWU9QMis1dEVsV09QdkxnTmhnCms0d1Q3MmN0VkdPakFDTDhybG8w
            dnBvTEdwNHpSTWZpVEs3QmFqNlZJelkKLS0tIFVUN1JzZHhRcFVReWNRZjRMZFNh
            QW9oRUd3Mkc0REh0dTFGeDlmRWN0VHMKdJWe+WYqiBKKhOEDeZTebYhZ5ev0I/i9
            9mSQmEzagbpajvaJOR9Tf1oQwEK3NZz8n/8PsfXN8zcC2QidvIjscg==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-09-09T02:02:00Z"
    mac: ENC[AES256_GCM,data:KG81tCETNfJyO07AcTM/X0rWT8NufXw3Fg4Sf5TFBwB2uTKv0Ww78loVP++heMeWpwByTD9ZEsc+3wIioaFvb0NninvGAUa6hfJNm0SuD2bfNKPD8ZjnXPYRr2jj/u1jcH1Q6bXUcysEx0q8p1jtw5KMWOHLA2umwgEQcjJDgTQ=,iv:T5lV3VjeEjUTyEwqKJzdF88X4b/1q/LgNbViWMFW3Mk=,tag:k0l3nT20l/hqw+jxS8fd5A==,type:str]
    pgp: []
    encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
    version: 3.8.1
