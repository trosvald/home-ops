version: v1alpha1
debug: false
persist: true
machine:
  type: controlplane
  token: c65me0.gsh46hixpiwr2cd0
  ca:
    crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJQakNCOGFBREFnRUNBaEFpamtjYmJoTlNKbzQyOEg0NkJ2N1lNQVVHQXl0bGNEQVFNUTR3REFZRFZRUUsKRXdWMFlXeHZjekFlRncweU5EQXhNREl4TURJMU1USmFGdzB6TXpFeU16QXhNREkxTVRKYU1CQXhEakFNQmdOVgpCQW9UQlhSaGJHOXpNQ293QlFZREsyVndBeUVBMUtsdUFGd0ZQMWt5a3pHVmVweVYyYmpEZFhzYkRSOS94bEJpClM5WGVtVHVqWVRCZk1BNEdBMVVkRHdFQi93UUVBd0lDaERBZEJnTlZIU1VFRmpBVUJnZ3JCZ0VGQlFjREFRWUkKS3dZQkJRVUhBd0l3RHdZRFZSMFRBUUgvQkFVd0F3RUIvekFkQmdOVkhRNEVGZ1FVMHdBVEJyYXNqWllZOWZrbQovZ0RSaDBjYU93OHdCUVlESzJWd0EwRUF1Mmg4T2ZaU25sdStGT3RhNWF6ZWFzZkNmRVU1TldYWng0aEpzak5vCndIRy9MeDVHcnpvOTZNeW1VWXlvU1UzK3pISHBPWEtuc0lZUXZiaVRkNU1JQWc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    key: LS0tLS1CRUdJTiBFRDI1NTE5IFBSSVZBVEUgS0VZLS0tLS0KTUM0Q0FRQXdCUVlESzJWd0JDSUVJQ1J5MDlLcWVoNE9XTzJBZExnaGtoZ3h3VWtBT3ZydVlOcDJUd1l1dHRwaAotLS0tLUVORCBFRDI1NTE5IFBSSVZBVEUgS0VZLS0tLS0K
  certSANs:
    - 172.16.11.10
    - 127.0.0.1
  kubelet:
    image: ghcr.io/siderolabs/kubelet:${KUBERNETES_VERSION}
    extraArgs:
      rotate-server-certificates: "true"
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 172.16.11.0/24
    disableManifestsDirectory: true
  network:
    hostname: p-tlx-k8s-m2.monosense.io
    interfaces:
      - interface: eno1
        ignore: true
      - interface: enp1s0
        addresses:
          - 172.16.11.13/24
        routes:
          - network: 0.0.0.0/0
            gateway: 172.16.11.254
        vlans:
          - addresses:
              - 172.16.13.13/24
            routes: []
            dhcp: false
            vlanId: 1613
            mtu: 1500
          - addresses:
              - 172.16.14.13/24
            routes: []
            dhcp: false
            vlanId: 1614
            mtu: 1500
        mtu: 9000
        dhcp: false
        vip:
          ip: 172.16.11.10
      - interface: enp1s0d1
        addresses:
          - 172.16.15.13/24
        mtu: 9000
        dhcp: false
    nameservers:
      - 172.16.11.9
      - 172.16.11.102
    extraHostEntries:
      - ip: 172.16.11.10
        aliases:
          - k8s.monosense.io
          - main.monosense.io
    disableSearchDomain: true
  install:
    disk: /dev/sda
    extraKernelArgs:
      - mitigations=off
      - module_blacklist=e1000e
    image: factory.talos.dev/installer/${TALOS_SCHEMATIC_ID}:${TALOS_VERSION}
    wipe: false
  files:
    - content: |-
        [plugins]
          [plugins."io.containerd.grpc.v1.cri"]
            enable_unprivileged_ports = true
            enable_unprivileged_icmp = true
          [plugins."io.containerd.grpc.v1.cri".containerd]
            discard_unpacked_layers = false
          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
            discard_unpacked_layers = false
      permissions: 0
      path: /etc/cri/conf.d/20-customization.part
      op: create
    - content: |-
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        noatime=True
        nodiratime=True
        rsize=131072
        wsize=131072
        nconnect=8
      permissions: 420
      path: /etc/nfsmount.conf
      op: overwrite
  time:
    disabled: false
    servers:
      - 172.16.11.254
      - 172.16.11.2
      - 172.16.11.9
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    kernel.randomize_va_space: "0"
    net.core.netdev_max_backlog: "30000"
    net.core.rmem_max: "67108864"
    net.core.wmem_max: "67108864"
    net.ipv4.tcp_rmem: 4096 87380 33554432
    net.ipv4.tcp_tw_reuse: "1"
    net.ipv4.tcp_window_scaling: "1"
    net.ipv4.tcp_wmem: 4096 65536 33554432
  features:
    rbac: true
    stableHostname: true
    kubernetesTalosAPIAccess:
      enabled: true
      allowedRoles:
        - os:admin
      allowedKubernetesNamespaces:
        - system-upgrade
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      forwardKubeDNSToHost: false
      resolveMemberNames: true
  nodeLabels:
    factory.talos.dev/schematic-prefix: ${SCHEMATIC_PREFIX}
    factory.talos.dev/schematic-suffix: ${SCHEMATIC_SUFFIX}
    topology.kubernetes.io/region: main
    topology.kubernetes.io/zone: m
cluster:
  id: HKCCcpAAWM1MTzLcYlJlO1b1DWI69Uq2nQ6h3trRWts=
  secret: x8/P/B701fx+a5GnCriCWBrkzCxck5aTjg6Xjx63AzA=
  controlPlane:
    endpoint: https://k8s.monosense.io:6443
  clusterName: main
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.42.0.0/16
    serviceSubnets:
      - 10.43.0.0/16
  token: c9pp1k.3unl68lpm0dj2klm
  secretboxEncryptionSecret: mkzljhJqhD8d0Cn5wAWcCo3WHZAJHWwiDBb/rvwdK0A=
  ca:
    crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJpakNDQVMrZ0F3SUJBZ0lRYWE5dzlIazRLT0NwUys4VjJQRWxBakFLQmdncWhrak9QUVFEQWpBVk1STXcKRVFZRFZRUUtFd3ByZFdKbGNtNWxkR1Z6TUI0WERUSTBNREV3TWpFd01qVXhNbG9YRFRNek1USXpNREV3TWpVeApNbG93RlRFVE1CRUdBMVVFQ2hNS2EzVmlaWEp1WlhSbGN6QlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VICkEwSUFCTFpiTHBtYW9TYmg2VTY2TTRaVCtkeDd5NnpWVkg4bklUMkNQR3g4WjlncVFIcjV4dU94bVkvek1mWnYKcjA0UVFqUU41c3JwU25aRFJVaVc1UVlvd0RPallUQmZNQTRHQTFVZER3RUIvd1FFQXdJQ2hEQWRCZ05WSFNVRQpGakFVQmdnckJnRUZCUWNEQVFZSUt3WUJCUVVIQXdJd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFCkZnUVVYeHR0aG5UamFhblJpSUhDSExHV21DRjNucFF3Q2dZSUtvWkl6ajBFQXdJRFNRQXdSZ0loQU0wY3Y2cEEKNzBMOVFva1lWanc5d3czckI0aGRWK0hNV0FHMUgrVnMxUU9OQWlFQW1NZGhocVBzbXdIY1pBcGEveE1WSUt2RQpwNmhEWWxuWjczU1V2dWhTb0NBPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    key: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUJLMVIrNkxpd3g5N2gzNWJNdDdnWUlpVEhmVDNGZVg1OUIxSEsrZWswREFvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFdGxzdW1acWhKdUhwVHJvemhsUDUzSHZMck5WVWZ5Y2hQWUk4Ykh4bjJDcEFldm5HNDdHWgpqL014OW0rdlRoQkNOQTNteXVsS2RrTkZTSmJsQmlqQU13PT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo=
  aggregatorCA:
    crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJZRENDQVFXZ0F3SUJBZ0lRSkR3ellBTStMVS9QM3JCS0pGbHpXakFLQmdncWhrak9QUVFEQWpBQU1CNFgKRFRJME1ERXdNakV3TWpVeE1sb1hEVE16TVRJek1ERXdNalV4TWxvd0FEQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxRwpTTTQ5QXdFSEEwSUFCRU01S0JIK2V1b0xFdTVXR3ZVcXdHM1BDMDQwOC90bG8zL3RUUVRibWtIcDJoeDZ5ajRNCnB2MUEyRTh3Y0haalRTMnNzV0RXa1dOZ0RzM3ExVSt5R09TallUQmZNQTRHQTFVZER3RUIvd1FFQXdJQ2hEQWQKQmdOVkhTVUVGakFVQmdnckJnRUZCUWNEQVFZSUt3WUJCUVVIQXdJd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZApCZ05WSFE0RUZnUVV3YkZDZUZlcXpXRlBPU3BnVmxzQTUycFQ3U0l3Q2dZSUtvWkl6ajBFQXdJRFNRQXdSZ0loCkFNNjkrY2xlcWprQTlJcHYzRUNMMnlTTGljNG1DRWxzZ0xOUlpyQkZVUXNjQWlFQWlHOEVNZ2FTc2dYQlNrU2MKV1hXYW1XeEVWdmxhVzZhVWdPNnljY1dKYjhVPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    key: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUJwSTlkcWVPUElPankwRzF1QUluYVZ4dmJNUWtCS29GdW9RZC9aS1FVVndvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFUXprb0VmNTY2Z3NTN2xZYTlTckFiYzhMVGpUeisyV2pmKzFOQk51YVFlbmFISHJLUGd5bQovVURZVHpCd2RtTk5MYXl4WU5hUlkyQU96ZXJWVDdJWTVBPT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo=
  serviceAccount:
    key: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUc0cFBFS3pGVFBldUd4bENzcnRkbDdHZkFBdGhkTEpDN05hbXYvMlIvMDRvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFMytEckFZRzZUUjV0cnJDTTMxUGtmWklxVS9ZTlJybnFnOTkwcHltSlpzQXkwMHRka29ZcwpMOENocnhtRGNEeDZldGZvTUdEanFLVDY0bUhxeHBQYzJ3PT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo=
  apiServer:
    image: registry.k8s.io/kube-apiserver:${KUBERNETES_VERSION}
    certSANs:
      - k8s.monosense.io
      - 172.16.11.10
      - 127.0.0.1
    disablePodSecurityPolicy: true
    auditPolicy:
      apiVersion: audit.k8s.io/v1
      kind: Policy
      rules:
        - level: Metadata
  controllerManager:
    image: registry.k8s.io/kube-controller-manager:${KUBERNETES_VERSION}
    extraArgs:
      bind-address: 0.0.0.0
  proxy:
    disabled: true
    image: registry.k8s.io/kube-proxy:${KUBERNETES_VERSION}
  scheduler:
    image: registry.k8s.io/kube-scheduler:${KUBERNETES_VERSION}
    extraArgs:
      bind-address: 0.0.0.0
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: false
      service:
        disabled: false
  etcd:
    ca:
      crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJmVENDQVNPZ0F3SUJBZ0lRSkFDZFg1b2JNZmRCcGV0SUdmenpYREFLQmdncWhrak9QUVFEQWpBUE1RMHcKQ3dZRFZRUUtFd1JsZEdOa01CNFhEVEkwTURFd01qRXdNalV4TWxvWERUTXpNVEl6TURFd01qVXhNbG93RHpFTgpNQXNHQTFVRUNoTUVaWFJqWkRCWk1CTUdCeXFHU000OUFnRUdDQ3FHU000OUF3RUhBMElBQkhPL2dqZS82NnVDCm1uU1pmVnlBZFVOSHpJRit6eUFQRmZJbVliZk9GblhmeFRzalZHVVJmZkZlWDFJVFJPUHRjWi9JTWtqN05jNG0KNnRiZ1pJMENFaGFqWVRCZk1BNEdBMVVkRHdFQi93UUVBd0lDaERBZEJnTlZIU1VFRmpBVUJnZ3JCZ0VGQlFjRApBUVlJS3dZQkJRVUhBd0l3RHdZRFZSMFRBUUgvQkFVd0F3RUIvekFkQmdOVkhRNEVGZ1FVd3NpSW51eFJmdGRLCjc0QjdselphVHBKU3JIMHdDZ1lJS29aSXpqMEVBd0lEU0FBd1JRSWdmZEhWV0tkTHRvb09hZ1BBWDhuUit3VEcKWFBQWHpoeThIZnRmYnRmaWYzMENJUUNtblh2elNwZHJjcngzWTl2aUc4eXUwb2tTSEpWTmVtSm5RNnFQZ3EvWAplQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
      key: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUpRTzdiVlk4WUcyZEt4VmJnOEhPMVFPNWhwUUZ6akU4WEVpR3ltVkJrckFvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFYzcrQ043L3JxNEthZEpsOVhJQjFRMGZNZ1g3UElBOFY4aVpodDg0V2RkL0ZPeU5VWlJGOQo4VjVmVWhORTQrMXhuOGd5U1BzMXppYnExdUJralFJU0ZnPT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo=
    extraArgs:
      listen-metrics-urls: http://0.0.0.0:2381
    advertisedSubnets:
      - 172.16.11.0/24
  coreDNS:
    disabled: true
  allowSchedulingOnMasters: true
